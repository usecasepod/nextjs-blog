<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png"/><link rel="manifest" href="/favicons/site.webmanifest"/><link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicons/favicon.ico"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><meta name="theme-color" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="description" content="A statically generated blog example using Next.js and Markdown."/><meta property="og:image" content="https://og-image.vercel.app/Next.js%20Blog%20Starter%20Example.png?theme=light&amp;md=1&amp;fontSize=100px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fnextjs-black-logo.svg"/><link href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-coy-without-shadows.min.css" rel="stylesheet"/><title>Use Case Podcast | Exploring MVU Part 2: Composition</title><meta name="next-head-count" content="16"/><link rel="preload" href="/nextjs-blog/_next/static/css/5e30997940c20b7e.css" as="style"/><link rel="stylesheet" href="/nextjs-blog/_next/static/css/5e30997940c20b7e.css" data-n-g=""/><link rel="preload" href="/nextjs-blog/_next/static/css/f82be52b39eb7e65.css" as="style"/><link rel="stylesheet" href="/nextjs-blog/_next/static/css/f82be52b39eb7e65.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/nextjs-blog/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/nextjs-blog/_next/static/chunks/webpack-e93be5bcb8523e51.js" defer=""></script><script src="/nextjs-blog/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/nextjs-blog/_next/static/chunks/main-a0853fbc3d9f629b.js" defer=""></script><script src="/nextjs-blog/_next/static/chunks/pages/_app-ff4c1a49d0216aaf.js" defer=""></script><script src="/nextjs-blog/_next/static/chunks/889-9d34752cad526b00.js" defer=""></script><script src="/nextjs-blog/_next/static/chunks/pages/posts/%5Bslug%5D-31a6d48cca446c7b.js" defer=""></script><script src="/nextjs-blog/_next/static/d-rhNPmEhgDySy-i2oJSD/_buildManifest.js" defer=""></script><script src="/nextjs-blog/_next/static/d-rhNPmEhgDySy-i2oJSD/_ssgManifest.js" defer=""></script><script src="/nextjs-blog/_next/static/d-rhNPmEhgDySy-i2oJSD/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="min-h-screen"><main><div><div class="h-2 bg-yellow-900"></div><nav class="bg-white shadow"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between h-16"><div class="flex"><a href="/" class="border-yellow-700 text-gray-900 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Use Case Podcast</a><div class="hidden sm:ml-6 sm:flex sm:space-x-8"><a href="https://rdbl.co/2QD97YJ" target="_blank" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Merch Store</a><a href="/about-us" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">About Us</a></div></div><div class="-mr-2 flex items-center sm:hidden"><button class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-yellow-700" id="headlessui-disclosure-button-undefined" type="button" aria-expanded="false"><span class="sr-only">Open main menu</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" class="block h-6 w-6"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"></path></svg></button></div></div></div></nav></div><div class="container mx-auto px-5"><h2 class="text-2xl md:text-4xl font-bold tracking-tight md:tracking-tighter leading-tight mb-20 mt-8"><a class="hover:underline" href="/">Posts</a>.</h2><article class="mb-32"><h1 class="text-6xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-left">Exploring MVU Part 2: Composition</h1><div class="hidden md:block md:mb-12"><div class="flex items-center"><div class="text-xl font-bold">Austin Webre</div></div></div><div><div class="block md:hidden mb-6"><div class="flex items-center"><div class="text-xl font-bold">Austin Webre</div></div></div><div class="mb-6 text-lg"><time dateTime="2020-05-24">May	24, 2020</time></div></div><div><div class="markdown-styles_markdown__h_8de"><p>So a couple days have come and gone and I'm still riding high on my experience with the MVU pattern. I'm struggling some with the syntax of F#, but I'm getting it bit by bit and even learning to love some aspects of it. That being said, the sample app I went through last time did nothing but peak my interest. It felt really smooth and easy to reason about, but "Counters" always are, right? So the next logical question is, how do we make this work for a more complicated situation?</p>
<p>I did some digging, but all the examples I could find simply stuffed more code into the view. Which is fine for smaller tasks, but thats just not sustainable for an app with multiple pages and navigation. So I started googling but ended up going in all the wrong directions. Eventually, I came across something in the docs for Elmish (an F# MVU-like framework) that really opened things up. In the example, there's a <code>Counter</code> module that is used by a <code>CounterList</code> module which reuses the <code>Counter</code>'s model, update, and view logic. I could post the example and we could go through it, but I thought this might be a good chance to make some progress on <code>commutr_v2</code>.</p>
<p>I'm going to start by trying to recreate the first page of the <code>commutr</code> app, which displays all the vehicles that you can track. Now in a future version of this app, we're going to skip this step if the user has marked a "Primary" vehicle. So really, this work is mostly going to be useless if it ever gets off the ground. But its a good simple case and a good first place to start. My first instinct is to follow the counter example I explained above. So we'll start with the smallest part first.</p>
<h1>VehicleItem.fs</h1>
<div class="remark-highlight"><pre class="language-fsharp"><code class="language-fsharp"><span class="token keyword">namespace</span> commutr_v2

<span class="token keyword">open</span> Fabulous
<span class="token keyword">open</span> Fabulous<span class="token punctuation">.</span>XamarinForms
<span class="token keyword">open</span> Xamarin<span class="token punctuation">.</span>Forms

<span class="token keyword">module</span> VehicleItem <span class="token operator">=</span>
    <span class="token keyword">type</span> <span class="token class-name">Model</span> <span class="token operator">=</span>
      <span class="token punctuation">{</span> Id <span class="token punctuation">:</span> <span class="token class-name">int</span>
        Make <span class="token punctuation">:</span> <span class="token class-name">string</span>
        Model <span class="token punctuation">:</span> <span class="token class-name">string</span>
        Year <span class="token punctuation">:</span> <span class="token class-name">int</span>
        IsPrimary <span class="token punctuation">:</span> <span class="token class-name">bool</span> <span class="token punctuation">}</span>

    <span class="token keyword">type</span> <span class="token class-name">Msg</span> <span class="token operator">=</span>
        <span class="token operator">|</span> TogglePrimary <span class="token keyword">of</span> <span class="token class-name">bool</span>

    <span class="token keyword">let</span> init <span class="token punctuation">(</span>initModel <span class="token punctuation">:</span> <span class="token class-name">Model</span><span class="token punctuation">)</span> <span class="token operator">=</span> initModel

    <span class="token keyword">let</span> update msg model <span class="token operator">=</span>
        <span class="token keyword">match</span> msg <span class="token keyword">with</span>
        <span class="token operator">|</span> TogglePrimary isPrimary <span class="token operator">-></span> <span class="token punctuation">{</span> model <span class="token keyword">with</span> IsPrimary <span class="token operator">=</span> isPrimary <span class="token punctuation">}</span>

    <span class="token keyword">let</span> view <span class="token punctuation">(</span>model<span class="token punctuation">:</span> <span class="token class-name">Model</span><span class="token punctuation">)</span> dispatch <span class="token operator">=</span>
        View<span class="token punctuation">.</span><span class="token function">StackLayout</span><span class="token punctuation">(</span>padding <span class="token operator">=</span> Thickness <span class="token number">20.0</span><span class="token punctuation">,</span> verticalOptions <span class="token operator">=</span> LayoutOptions<span class="token punctuation">.</span>Center<span class="token punctuation">,</span> orientation <span class="token operator">=</span> StackOrientation<span class="token punctuation">.</span>Horizontal<span class="token punctuation">,</span>
            children <span class="token operator">=</span> <span class="token punctuation">[</span>
                View<span class="token punctuation">.</span><span class="token function">Label</span><span class="token punctuation">(</span>text <span class="token operator">=</span> model<span class="token punctuation">.</span>Make<span class="token punctuation">,</span> horizontalOptions <span class="token operator">=</span> LayoutOptions<span class="token punctuation">.</span>Center<span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">200.0</span><span class="token punctuation">,</span> horizontalTextAlignment<span class="token operator">=</span>TextAlignment<span class="token punctuation">.</span>Center<span class="token punctuation">)</span>
                View<span class="token punctuation">.</span><span class="token function">Label</span><span class="token punctuation">(</span>text <span class="token operator">=</span> model<span class="token punctuation">.</span>Model<span class="token punctuation">,</span> horizontalOptions <span class="token operator">=</span> LayoutOptions<span class="token punctuation">.</span>Center<span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">200.0</span><span class="token punctuation">,</span> horizontalTextAlignment<span class="token operator">=</span>TextAlignment<span class="token punctuation">.</span>Center<span class="token punctuation">)</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div>
<p>This is pretty straight forward, so I won't go in too much detail. The plan here is to output a view that can be used as a child of a <code>CollectionView</code>. So we have our model which represents a vehicle, the update which can set whether the vehicle in question is "Primary", and the view which puts it all together. We may come back to this later, as I'm not entirely sure what actions will need to be handled here and what actions will need to be handled in parent components, but this seems like it handles everything I need for the moment.</p>
<p>Now that we have the smallest piece set up, lets move one step higher.</p>
<h1>VehicleListing.fs</h1>
<div class="remark-highlight"><pre class="language-fsharp"><code class="language-fsharp"><span class="token keyword">module</span> VehicleListing <span class="token operator">=</span>
    <span class="token keyword">type</span> <span class="token class-name">Model</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        Vehicles <span class="token punctuation">:</span> <span class="token class-name">VehicleItem<span class="token punctuation">.</span>Model</span> list
        SelectedVehicle <span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&#x3C;</span>VehicleItem<span class="token punctuation">.</span>Model<span class="token operator">></span>
        <span class="token punctuation">}</span>

    <span class="token keyword">type</span> <span class="token class-name">Msg</span> <span class="token operator">=</span>
        <span class="token operator">|</span> Insert
        <span class="token operator">|</span> Remove
        <span class="token operator">|</span> Modified <span class="token keyword">of</span> <span class="token class-name">int <span class="token operator">*</span> VehicleItem<span class="token punctuation">.</span>Msg</span>
        <span class="token operator">|</span> SelectVehicle <span class="token keyword">of</span> <span class="token class-name">int</span>

    <span class="token keyword">let</span> initModel <span class="token punctuation">:</span> <span class="token class-name">Model</span> <span class="token operator">=</span> <span class="token punctuation">{</span> Vehicles <span class="token operator">=</span> <span class="token punctuation">[</span>
                            <span class="token punctuation">{</span>Id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> Make <span class="token operator">=</span> <span class="token string">"Honda"</span><span class="token punctuation">;</span> Model <span class="token operator">=</span> <span class="token string">"Accord"</span><span class="token punctuation">;</span> Year <span class="token operator">=</span> <span class="token number">2005</span><span class="token punctuation">;</span> IsPrimary <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">}</span>
                            <span class="token punctuation">{</span>Id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> Make <span class="token operator">=</span> <span class="token string">"Honda"</span><span class="token punctuation">;</span> Model <span class="token operator">=</span> <span class="token string">"Insight"</span><span class="token punctuation">;</span> Year <span class="token operator">=</span> <span class="token number">2019</span><span class="token punctuation">;</span> IsPrimary <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">}</span>
                            <span class="token punctuation">]</span><span class="token punctuation">;</span>
                            SelectedVehicle <span class="token operator">=</span> None <span class="token punctuation">}</span>

    <span class="token keyword">let</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> initModel

    <span class="token keyword">let</span> update msg model <span class="token operator">=</span>
        <span class="token keyword">match</span> msg <span class="token keyword">with</span>
        <span class="token operator">|</span> Insert <span class="token operator">-></span> model <span class="token comment">//TODO: Make this do something</span>
        <span class="token operator">|</span> Remove <span class="token operator">-></span> model <span class="token comment">//TODO: Make this do something</span>
        <span class="token operator">|</span> Modified <span class="token punctuation">(</span>pos<span class="token punctuation">,</span> itemMessage<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">{</span> model <span class="token keyword">with</span> Vehicles <span class="token operator">=</span> model<span class="token punctuation">.</span>Vehicles
                                                        <span class="token operator">|></span> List<span class="token punctuation">.</span>mapi <span class="token punctuation">(</span><span class="token keyword">fun</span> i itemModel <span class="token operator">-></span>
                                                        <span class="token keyword">if</span> i <span class="token operator">=</span> pos <span class="token keyword">then</span>
                                                            VehicleItem<span class="token punctuation">.</span>update itemMessage itemModel
                                                        <span class="token keyword">else</span>
                                                            itemModel<span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> SelectVehicle pos <span class="token operator">-></span> <span class="token punctuation">{</span>model <span class="token keyword">with</span> SelectedVehicle <span class="token operator">=</span> <span class="token function">Some</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>Vehicles<span class="token punctuation">.</span><span class="token function">Item</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>

    <span class="token keyword">let</span> view <span class="token punctuation">(</span>model <span class="token punctuation">:</span> <span class="token class-name">Model</span><span class="token punctuation">)</span> dispatch <span class="token operator">=</span>
        <span class="token keyword">let</span> items <span class="token operator">=</span> model<span class="token punctuation">.</span>Vehicles <span class="token operator">|></span> List<span class="token punctuation">.</span><span class="token function">mapi</span><span class="token punctuation">(</span><span class="token keyword">fun</span> pos itemModel <span class="token operator">-></span>
                             VehicleItem<span class="token punctuation">.</span>view
                                itemModel
                                <span class="token punctuation">(</span><span class="token keyword">fun</span> msg <span class="token operator">-></span> dispatch <span class="token punctuation">(</span>Modified <span class="token punctuation">(</span>pos<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        View<span class="token punctuation">.</span><span class="token function">CollectionView</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span>
</code></pre></div>
<p>Now this is clearly a work in progress, but I wanted to map out where I'm heading while simultaneously getting the most simple case working first. There are three novel things that are happening here. The first is that part of the Model for this module is a list of models from the <code>VehicleItem</code> module. Model, module, model, module... bleh.</p>
<p>Anyway, the second is in <code>update</code>. You'll notice the arguments for the <code>Modified</code> case are <code>pos</code> (an integer representing the position of the requested item in the array - aka its index) and <code>itemMessage</code> which is of type <code>VehicleItem.Msg</code>. Those arguments are then used to update the model that matches the correct position using <code>VehicleItem.update</code>. So all we're doing is routing the message back to the appropriate update function so that the result is a list of updated <code>VehicleItem.Model</code>s. And since our <code>update</code> functions are pure, we don't need a specific instance of anything, just pass the model and the message and the result will be the updated model.</p>
<p>The last novel thing is in (you guessed it) the view. We get a list of items by mapping the List of <code>VehicleItem.Model</code> in our model to a list of Stack Layout Views via the <code>VehicleItem.view</code> function. There's something really interesting that we're doing here that makes this work. We're hijacking the <code>dispatch</code> function so that the <code>Modified</code> message gets sent instead. Its then up to our <code>Modified</code> message to update the appropriate item (using <code>VehicleItem.update</code> as we previously saw).</p>
<p>Hopefully that makes sense.</p>
<p>Now, you may notice that I defined a <code>SelectVehicle</code> message that will handle selection (and potentially navigation). I did this mostly just to work out how that might hypothetically look. It isn't used here because I realized that <code>CollectionView</code> requires you to wrap each item in a <code>SwipeView</code>, so we may have to move that logic down somehow. Or maybe not. I haven't gotten that far yet.</p>
<p>Back to making the simplest case work.</p>
<h1>Wiring It All Up</h1>
<p>So now that we have the Vehicle List worked out, lets tie it all together in the root <code>App</code> module.</p>
<div class="remark-highlight"><pre class="language-fsharp"><code class="language-fsharp"><span class="token keyword">namespace</span> commutr_v2

<span class="token keyword">open</span> System<span class="token punctuation">.</span>Diagnostics
<span class="token keyword">open</span> Fabulous
<span class="token keyword">open</span> Fabulous<span class="token punctuation">.</span>XamarinForms
<span class="token keyword">open</span> Fabulous<span class="token punctuation">.</span>XamarinForms<span class="token punctuation">.</span>LiveUpdate
<span class="token keyword">open</span> Xamarin<span class="token punctuation">.</span>Forms

<span class="token keyword">module</span> App <span class="token operator">=</span>
    <span class="token keyword">type</span> <span class="token class-name">Model</span> <span class="token operator">=</span>
      <span class="token punctuation">{</span> Vehicles <span class="token punctuation">:</span> <span class="token class-name">VehicleListing<span class="token punctuation">.</span>Model</span> <span class="token punctuation">}</span>

    <span class="token keyword">type</span> <span class="token class-name">Msg</span> <span class="token operator">=</span>
        <span class="token operator">|</span> VehicleListUpdated <span class="token keyword">of</span> <span class="token class-name">VehicleListing<span class="token punctuation">.</span>Msg</span>
        <span class="token operator">|</span> RefreshVehicles

    <span class="token keyword">let</span> initModel <span class="token operator">=</span> <span class="token punctuation">{</span> Vehicles <span class="token operator">=</span> VehicleListing<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>

    <span class="token keyword">let</span> init <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> initModel<span class="token punctuation">,</span> Cmd<span class="token punctuation">.</span>none

    <span class="token keyword">let</span> update msg model <span class="token operator">=</span>
        <span class="token keyword">match</span> msg <span class="token keyword">with</span>
        <span class="token operator">|</span> VehicleListUpdated listMsg <span class="token operator">-></span> <span class="token punctuation">{</span>model <span class="token keyword">with</span> Vehicles <span class="token operator">=</span> VehicleListing<span class="token punctuation">.</span>update listMsg model<span class="token punctuation">.</span>Vehicles<span class="token punctuation">}</span><span class="token punctuation">,</span> Cmd<span class="token punctuation">.</span>none
        <span class="token operator">|</span> RefreshVehicles <span class="token operator">-></span> <span class="token punctuation">{</span>model <span class="token keyword">with</span> Vehicles <span class="token operator">=</span> VehicleListing<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> Cmd<span class="token punctuation">.</span>none

    <span class="token keyword">let</span> view <span class="token punctuation">(</span>model<span class="token punctuation">:</span> <span class="token class-name">Model</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>dispatch <span class="token punctuation">:</span> <span class="token class-name">Dispatch</span><span class="token operator">&#x3C;</span>Msg<span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">=</span>
        <span class="token keyword">let</span> vehicleList <span class="token operator">=</span> VehicleListing<span class="token punctuation">.</span>view
                            model<span class="token punctuation">.</span>Vehicles
                            <span class="token punctuation">(</span><span class="token keyword">fun</span> msg <span class="token operator">-></span> dispatch <span class="token punctuation">(</span>VehicleListUpdated msg<span class="token punctuation">)</span><span class="token punctuation">)</span>
        View<span class="token punctuation">.</span><span class="token function">ContentPage</span><span class="token punctuation">(</span>
          content <span class="token operator">=</span> View<span class="token punctuation">.</span><span class="token function">StackLayout</span><span class="token punctuation">(</span>padding <span class="token operator">=</span> Thickness <span class="token number">20.0</span><span class="token punctuation">,</span> verticalOptions <span class="token operator">=</span> LayoutOptions<span class="token punctuation">.</span>Center<span class="token punctuation">,</span>
            children <span class="token operator">=</span> <span class="token punctuation">[</span>
                vehicleList
            <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">// Note, this declaration is needed if you enable LiveUpdate</span>
    <span class="token keyword">let</span> program <span class="token operator">=</span> XamarinFormsProgram<span class="token punctuation">.</span>mkProgram init update view

<span class="token keyword">type</span> <span class="token class-name">App</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> app <span class="token operator">=</span>
    <span class="token keyword">inherit</span> <span class="token class-name">Application</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">let</span> runner <span class="token operator">=</span>
        App<span class="token punctuation">.</span>program
<span class="token preprocessor property">#<span class="token directive keyword">if</span> DEBUG</span>
        <span class="token operator">|></span> Program<span class="token punctuation">.</span>withConsoleTrace
<span class="token preprocessor property">#<span class="token directive keyword">endif</span></span>
        <span class="token operator">|></span> XamarinFormsProgram<span class="token punctuation">.</span>run app
</code></pre></div>
<p>So this is not all that unsimilar to the <code>VehicleListing</code>. We make the child model part of our model and use the child's update and view logic in our own. The result isn't the prettiest, but it displays, so... a job well done?</p>
<p><img src="/assets/posts/mvu-composition/wired-up-ui.png" alt="Wired Up UI"></p>
<p>Clearly there are some changes that need to be made. For instance, not all the vehicle data is displayed and (to be quite frank) this UI is trash. So lets see if we can't make this thing just a little bit more appealing. The good news is this will likely involve mostly just tweaking the view code a little bit. So lets see what we can do...</p>
<p>We'll change the <code>view</code> function of the <code>VehicleListing</code> to be the following:</p>
<div class="remark-highlight"><pre class="language-fsharp"><code class="language-fsharp"><span class="token keyword">let</span> view <span class="token punctuation">(</span>model<span class="token punctuation">:</span> <span class="token class-name">Model</span><span class="token punctuation">)</span> dispatch <span class="token operator">=</span>
        View<span class="token punctuation">.</span>StackLayout
            <span class="token punctuation">(</span>padding <span class="token operator">=</span> Thickness <span class="token number">5.0</span><span class="token punctuation">,</span>
             children <span class="token operator">=</span>
                 <span class="token punctuation">[</span> View<span class="token punctuation">.</span>Frame
                     <span class="token punctuation">(</span>hasShadow <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">,</span>
                      backgroundColor <span class="token operator">=</span> AppColors<span class="token punctuation">.</span>ghostWhite<span class="token punctuation">,</span>
                      padding <span class="token operator">=</span> Thickness <span class="token number">10.0</span><span class="token punctuation">,</span>
                      content <span class="token operator">=</span>
                          View<span class="token punctuation">.</span>FlexLayout
                              <span class="token punctuation">(</span>margin <span class="token operator">=</span> Thickness <span class="token number">10.0</span><span class="token punctuation">,</span>
                               verticalOptions <span class="token operator">=</span> LayoutOptions<span class="token punctuation">.</span>Center<span class="token punctuation">,</span>
                               horizontalOptions <span class="token operator">=</span> LayoutOptions<span class="token punctuation">.</span>Center<span class="token punctuation">,</span>
                               alignItems <span class="token operator">=</span> FlexAlignItems<span class="token punctuation">.</span>Center<span class="token punctuation">,</span>
                               justifyContent <span class="token operator">=</span> FlexJustify<span class="token punctuation">.</span>SpaceEvenly<span class="token punctuation">,</span>
                               direction <span class="token operator">=</span> FlexDirection<span class="token punctuation">.</span>Row<span class="token punctuation">,</span>
                               children <span class="token operator">=</span>
                                   <span class="token punctuation">[</span> View<span class="token punctuation">.</span>SKCanvasView
                                       <span class="token punctuation">(</span>paintSurface <span class="token operator">=</span>
                                           <span class="token punctuation">(</span><span class="token keyword">fun</span> args <span class="token operator">-></span>
                                               <span class="token keyword">let</span> info <span class="token operator">=</span> args<span class="token punctuation">.</span>Info
                                               <span class="token keyword">let</span> surface <span class="token operator">=</span> args<span class="token punctuation">.</span>Surface
                                               <span class="token keyword">let</span> canvas <span class="token operator">=</span> surface<span class="token punctuation">.</span>Canvas

                                               canvas<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

                                               <span class="token keyword">use</span> paint <span class="token operator">=</span>
                                                   <span class="token keyword">new</span> <span class="token class-name">SkiaSharp<span class="token punctuation">.</span>SKPaint</span><span class="token punctuation">(</span>Style <span class="token operator">=</span> SkiaSharp<span class="token punctuation">.</span>SKPaintStyle<span class="token punctuation">.</span>Fill<span class="token punctuation">,</span>
                                                                         Color <span class="token operator">=</span>
                                                                             <span class="token punctuation">(</span><span class="token keyword">if</span> model<span class="token punctuation">.</span>IsPrimary <span class="token keyword">then</span>
                                                                                 AppColors<span class="token punctuation">.</span>mandarin<span class="token punctuation">.</span><span class="token function">ToSKColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                                                              <span class="token keyword">else</span>
                                                                                  AppColors<span class="token punctuation">.</span>silverSandLight<span class="token punctuation">.</span><span class="token function">ToSKColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                                         StrokeWidth <span class="token operator">=</span> <span class="token number">5.0f</span><span class="token punctuation">)</span>

                                               canvas<span class="token punctuation">.</span>DrawCircle
                                                   <span class="token punctuation">(</span>float32 <span class="token punctuation">(</span>info<span class="token punctuation">.</span>Width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> float32 <span class="token punctuation">(</span>info<span class="token punctuation">.</span>Height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10.0f</span><span class="token punctuation">,</span> paint<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                     View<span class="token punctuation">.</span><span class="token function">Label</span><span class="token punctuation">(</span>text <span class="token operator">=</span> model<span class="token punctuation">.</span>Year<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                     View<span class="token punctuation">.</span><span class="token function">Label</span><span class="token punctuation">(</span>text <span class="token operator">=</span> model<span class="token punctuation">.</span>Make<span class="token punctuation">)</span>
                                     View<span class="token punctuation">.</span><span class="token function">Label</span><span class="token punctuation">(</span>text <span class="token operator">=</span> model<span class="token punctuation">.</span>Model<span class="token punctuation">)</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div>
<p>Now thats quite a big difference, so lets break it down real quick.</p>
<p>The basic layout is a <code>StackLayout</code> with a single <code>Frame</code> as the child. This is done so that we can create space between list elements via padding. The <code>Frame</code>'s content is a <code>FlexLayout</code> which allows us to evenly space the elements horizontally. Finally, we have a dot drawn via SkiaSharp that indicates the which is the primary, along with the reast of the info for the vehicle.</p>
<p>The result looks like this:</p>
<p><img src="/assets/posts/mvu-composition/spiffy-vehicle-list.png" alt="Spiffy Vehicle List"></p>
<p>I decided to conditionally change the color of the primary indicator instead of hiding it so that things will continue to line up. The alignment and layout isn't perfect, but it feels pretty good so I'm going to leave it alone for now and move on to something more interesting. Lets try to wire up a <code>SwipeView</code> so that we can swipe on individual items and mark them as primary.</p>
<h1>Toggle Primary</h1>
<p>So before we get into the code that changed, I want to say that this was really quite painless to set up. In fact, most of the changes I've made were more improvments than they were "making it work". This is largely due to the nature of MVU. Since I spent a little bit of time mapping out what updates I wanted, the logic required to update the model was already there, it just took a little bit of work to finish putting it together. That being said lets dive in.</p>
<div class="remark-highlight"><pre class="language-fsharp"><code class="language-fsharp"><span class="token keyword">let</span> update msg model <span class="token operator">=</span>
        <span class="token keyword">match</span> msg <span class="token keyword">with</span>
        <span class="token operator">|</span> Insert <span class="token operator">-></span> model <span class="token comment">//TODO: Make this do something</span>
        <span class="token operator">|</span> Remove <span class="token operator">-></span> model <span class="token comment">//TODO: Make this do something</span>
        <span class="token operator">|</span> Modified <span class="token punctuation">(</span>pos<span class="token punctuation">,</span> itemMessage<span class="token punctuation">)</span> <span class="token operator">-></span>
            <span class="token keyword">match</span> itemMessage <span class="token keyword">with</span>
            <span class="token operator">|</span> VehicleItem<span class="token punctuation">.</span>Msg<span class="token punctuation">.</span>TogglePrimary isPrimary <span class="token operator">-></span>
                <span class="token punctuation">{</span> model <span class="token keyword">with</span>
                      Vehicles <span class="token operator">=</span>
                          model<span class="token punctuation">.</span>Vehicles
                          <span class="token operator">|></span> List<span class="token punctuation">.</span>mapi <span class="token punctuation">(</span><span class="token keyword">fun</span> i itemModel <span class="token operator">-></span>
                              <span class="token keyword">if</span> i <span class="token operator">=</span> pos <span class="token keyword">then</span>
                                  VehicleItem<span class="token punctuation">.</span>update itemMessage itemModel
                              <span class="token keyword">else</span>
                                  <span class="token punctuation">(</span><span class="token keyword">if</span> isPrimary <span class="token operator">&#x26;&#x26;</span> itemModel<span class="token punctuation">.</span>IsPrimary
                                   <span class="token keyword">then</span> VehicleItem<span class="token punctuation">.</span>update <span class="token punctuation">(</span>VehicleItem<span class="token punctuation">.</span><span class="token function">TogglePrimary</span><span class="token punctuation">(</span><span class="token keyword">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> itemModel
                                   <span class="token keyword">else</span> itemModel<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token operator">|</span> SelectVehicle pos <span class="token operator">-></span>
            <span class="token punctuation">{</span> model <span class="token keyword">with</span>
                  SelectedVehicle <span class="token operator">=</span> <span class="token function">Some</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>Vehicles<span class="token punctuation">.</span><span class="token function">Item</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>

    <span class="token keyword">let</span> view <span class="token punctuation">(</span>model<span class="token punctuation">:</span> <span class="token class-name">Model</span><span class="token punctuation">)</span> dispatch <span class="token operator">=</span>
        <span class="token keyword">let</span> items <span class="token operator">=</span>
            model<span class="token punctuation">.</span>Vehicles
            <span class="token operator">|></span> List<span class="token punctuation">.</span>mapi <span class="token punctuation">(</span><span class="token keyword">fun</span> pos itemModel <span class="token operator">-></span>
                View<span class="token punctuation">.</span>SwipeView
                    <span class="token punctuation">(</span>backgroundColor <span class="token operator">=</span> AppColors<span class="token punctuation">.</span>silverSandLight<span class="token punctuation">,</span>
                     rightItems <span class="token operator">=</span>
                         View<span class="token punctuation">.</span>SwipeItems
                             <span class="token punctuation">(</span>items <span class="token operator">=</span>
                                 <span class="token punctuation">[</span> View<span class="token punctuation">.</span>SwipeItem
                                     <span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token keyword">not</span> itemModel<span class="token punctuation">.</span>IsPrimary <span class="token keyword">then</span> <span class="token string">"Primary"</span> <span class="token keyword">else</span> <span class="token string">"Not Primary"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                      backgroundColor <span class="token operator">=</span>
                                          <span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token keyword">not</span> itemModel<span class="token punctuation">.</span>IsPrimary <span class="token keyword">then</span>
                                              AppColors<span class="token punctuation">.</span>mandarin
                                           <span class="token keyword">else</span>
                                               AppColors<span class="token punctuation">.</span>silverSandMediumDark<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                      command <span class="token operator">=</span>
                                          <span class="token keyword">fun</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span>
                                              dispatch
                                                  <span class="token punctuation">(</span><span class="token function">Modified</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span> VehicleItem<span class="token punctuation">.</span><span class="token function">TogglePrimary</span><span class="token punctuation">(</span><span class="token keyword">not</span> itemModel<span class="token punctuation">.</span>IsPrimary<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                     content <span class="token operator">=</span> VehicleItem<span class="token punctuation">.</span>view itemModel <span class="token punctuation">(</span><span class="token keyword">fun</span> msg <span class="token operator">-></span> dispatch <span class="token punctuation">(</span><span class="token function">Modified</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        View<span class="token punctuation">.</span><span class="token function">CollectionView</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span>
</code></pre></div>
<p>Let's start by looking at the <code>view</code> function. Instead of mapping our <code>VehicleItem.Model</code>'s directly to their <code>view</code> function, we wrap them in a <code>SwipeView</code>. I think it would have also been feasible to implement the swipe view one step down in the body of <code>VehicleItem.view</code>, but it felt right to keep <code>VehicleItem</code> to strictly displaying the Vehicle information.</p>
<p>You'll notice that the <code>SwipeView</code> contains a <code>SwipeItem</code> which has some conditional rendering of the text and background color. This is just so that we can distinguish between adding and removing the "Primary" status. I used the <code>SwipeItem</code>'s command property to fire dispatch and send the appropriate message. Really and truly, I realized that my <code>Modified</code> message handling is a bit more complicated than it needs to be right now. This is because I'm assuming that <code>VehicleItem</code> will eventually require additional messages (for things like updating the Make, Model) and that that logic will need to be <em>different</em> from the logic that handles IsPrimary.</p>
<p>This is primarily for two different reasons. One is that only one vehicle can have "Primary" status at a time, so if "Primary" status changes for one vehicle, it <em>may</em> affect the others (this is reflected in the <code>update</code> function, but we'll get to that in a minute). This is simply not true of other properties like Make, Model, and Year.</p>
<p>The second reason is actually not visible in the above code. There is a small change I made to <code>VehicleItem</code>, which basically amounts to forcing SkiaSharp to redraw the little circles on every update. This is fine for right now, because the only reason <code>VehicleItem.update</code> is called at the moment is to change <code>IsPrimary</code> which requires a redraw of the dot. However, as we add other messages, we will need to make sure we don't redraw on every update as this will result in performance hits.</p>
<p>So this is where we are UI-wise:</p>
<p><img src="/assets/posts/mvu-composition/mark-primary.gif" alt="Mark Primary UI"></p>
<p>You'll notice that selecting one as Primary makes the other not primary (if it already was). This logic is handled in our <code>update</code> function. Our <code>Modified</code> message contains the position and the <code>VehicleItem.Msg</code> we want to pass on to <code>VehicleItem.update</code>. Now we could for the time being have made <code>Modified</code> to contain the <code>TogglePrimary</code> message instead of any <code>VehicleItem.Msg</code>, because for now that's the only message that <code>VehicleItem</code> has, but as I said earlier, this will allow us to handle future scenarios where we want to edit other information. So we pattern match on <code>itemMessage</code> and handle the only existing case (where <code>itemMessage</code> is the <code>TogglePrimary</code> message).</p>
<p>We are also no longer simply calling <code>VehicleItem.update</code> on the item that matches the position we were given. We're also checking if we're setting a new item as Primary and mark any other items that are currently "Primary" to false. This will ensure that only one item is ever marked as Primary at a time.</p>
<p>Before we wrap things up, I want to mention that I <em>think</em> this validates my assumption that we can handle "Selecting" a particular vehicle item within <code>VehicleListing</code>. We should be able to call dispatch to send a selection message from a <code>SwipeItem</code>.</p>
<h1>Wrapping Up</h1>
<p>So I think this is the state I'll leave the app in for the purposes of this article. I think it gives a pretty good idea of how composition in MVU can allow us to break out parts of the UI into smaller units. So I guess the question is, what did we learn from this?</p>
<p>My first big take away is that this architecture is so straight forward that it was fairly easy for me to do a lot of planning ahead without really having a super great understanding of how all the pieces would fit together. For instance, I was pleasantly surprised by how decisions I made when creating <code>VehicleItem</code> panned out when connecting them to <code>VehicleListing</code>. The simplicity of this framework really does allow you to think clearly and accurately about what changes should and will occur to the model as well as what the resulting UI will look like.</p>
<p>I will note that I did not do any Commanding, which I think will complicate matters when it is needed, but the beautify of this framework is that its not necessary so far, so I didn't have to use it.</p>
<p>I'd also like to take this time to mention that I did have certain struggles with using additional libraries. One thing I've come to realize is that there isn't a lot of documentation for Fabulous and that examples of F# code in general are hard to find. This can make it difficult to learn, but also frustrating for someone who is used to being able to "just read the docs".</p>
<p>Another thing I'd like to note is that quite frankly, 3rd party support for F# in Xamarin.Forms basically does not exist. I had wanted to use Sharpnado's MaterialFrame so I could get the Acrylic look, but quickly found out that MaterialFrame is built to be used strictly in XAML. This was a bit disappointing, but ultimately not a big deal. My hope is that with .NET MAUI, we'll start to see some of these UI tools become more "Functional Friendly" with built in support that goes beyond data binding and MVVM.</p>
<p>I do plan to continue working on this project, but I think this will be my last blog on it for a while. I need to spend some more time digging in to F# and MVU so that I can really understand it and find some interesting ways to use it, before I can share any more insights.</p>
<p>In the meantime, go give us some listens and feel free to reach out in the comments below, on Twitter <a href="twitter.com/usecasepod">@usecasepod</a>, or <a href="mailto:usecasepod@gmail.com">via email (usecasepod@gmail.com)</a>.</p>
<p>You can also find the full repository for this app <a href="https://github.com/usecasepod/commutr_v2">on our Github</a>, but keep in mind that this is going to be a living project, so what you see in this post today may not be reflected in the current version of the app.</p>
</div></div></article></div></main></div><footer class="bg-accent-1 border-t border-accent-2"><div class="container mx-auto px-5"><div class="py-28 flex flex-col lg:flex-row items-center"><h3 class="text-4xl lg:text-5xl font-bold tracking-tighter leading-tight text-center lg:text-left mb-10 lg:mb-0 lg:pr-4 lg:w-1/2">The power is yours...</h3></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"date":"2020-05-24","slug":"2020-05-24-mvu-composition","content":"\u003cp\u003eSo a couple days have come and gone and I'm still riding high on my experience with the MVU pattern. I'm struggling some with the syntax of F#, but I'm getting it bit by bit and even learning to love some aspects of it. That being said, the sample app I went through last time did nothing but peak my interest. It felt really smooth and easy to reason about, but \"Counters\" always are, right? So the next logical question is, how do we make this work for a more complicated situation?\u003c/p\u003e\n\u003cp\u003eI did some digging, but all the examples I could find simply stuffed more code into the view. Which is fine for smaller tasks, but thats just not sustainable for an app with multiple pages and navigation. So I started googling but ended up going in all the wrong directions. Eventually, I came across something in the docs for Elmish (an F# MVU-like framework) that really opened things up. In the example, there's a \u003ccode\u003eCounter\u003c/code\u003e module that is used by a \u003ccode\u003eCounterList\u003c/code\u003e module which reuses the \u003ccode\u003eCounter\u003c/code\u003e's model, update, and view logic. I could post the example and we could go through it, but I thought this might be a good chance to make some progress on \u003ccode\u003ecommutr_v2\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eI'm going to start by trying to recreate the first page of the \u003ccode\u003ecommutr\u003c/code\u003e app, which displays all the vehicles that you can track. Now in a future version of this app, we're going to skip this step if the user has marked a \"Primary\" vehicle. So really, this work is mostly going to be useless if it ever gets off the ground. But its a good simple case and a good first place to start. My first instinct is to follow the counter example I explained above. So we'll start with the smallest part first.\u003c/p\u003e\n\u003ch1\u003eVehicleItem.fs\u003c/h1\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-fsharp\"\u003e\u003ccode class=\"language-fsharp\"\u003e\u003cspan class=\"token keyword\"\u003enamespace\u003c/span\u003e commutr_v2\n\n\u003cspan class=\"token keyword\"\u003eopen\u003c/span\u003e Fabulous\n\u003cspan class=\"token keyword\"\u003eopen\u003c/span\u003e Fabulous\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eXamarinForms\n\u003cspan class=\"token keyword\"\u003eopen\u003c/span\u003e Xamarin\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eForms\n\n\u003cspan class=\"token keyword\"\u003emodule\u003c/span\u003e VehicleItem \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eModel\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e Id \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eint\u003c/span\u003e\n        Make \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003estring\u003c/span\u003e\n        Model \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003estring\u003c/span\u003e\n        Year \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eint\u003c/span\u003e\n        IsPrimary \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003ebool\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eMsg\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e TogglePrimary \u003cspan class=\"token keyword\"\u003eof\u003c/span\u003e \u003cspan class=\"token class-name\"\u003ebool\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e init \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003einitModel \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eModel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e initModel\n\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e update msg model \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ematch\u003c/span\u003e msg \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e TogglePrimary isPrimary \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e model \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e IsPrimary \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e isPrimary \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e view \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eModel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e dispatch \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n        View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eStackLayout\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epadding \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Thickness \u003cspan class=\"token number\"\u003e20.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e verticalOptions \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e LayoutOptions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCenter\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e orientation \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e StackOrientation\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eHorizontal\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            children \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n                View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eLabel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etext \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eMake\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e horizontalOptions \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e LayoutOptions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCenter\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e width\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e200.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e horizontalTextAlignment\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eTextAlignment\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCenter\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eLabel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etext \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eModel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e horizontalOptions \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e LayoutOptions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCenter\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e width\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e200.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e horizontalTextAlignment\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eTextAlignment\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCenter\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis is pretty straight forward, so I won't go in too much detail. The plan here is to output a view that can be used as a child of a \u003ccode\u003eCollectionView\u003c/code\u003e. So we have our model which represents a vehicle, the update which can set whether the vehicle in question is \"Primary\", and the view which puts it all together. We may come back to this later, as I'm not entirely sure what actions will need to be handled here and what actions will need to be handled in parent components, but this seems like it handles everything I need for the moment.\u003c/p\u003e\n\u003cp\u003eNow that we have the smallest piece set up, lets move one step higher.\u003c/p\u003e\n\u003ch1\u003eVehicleListing.fs\u003c/h1\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-fsharp\"\u003e\u003ccode class=\"language-fsharp\"\u003e\u003cspan class=\"token keyword\"\u003emodule\u003c/span\u003e VehicleListing \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eModel\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        Vehicles \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eVehicleItem\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eModel\u003c/span\u003e list\n        SelectedVehicle \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eOption\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003eVehicleItem\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eModel\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eMsg\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e Insert\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e Remove\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e Modified \u003cspan class=\"token keyword\"\u003eof\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eint \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e VehicleItem\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eMsg\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e SelectVehicle \u003cspan class=\"token keyword\"\u003eof\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eint\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e initModel \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eModel\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e Vehicles \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n                            \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003eId \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e Make \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Honda\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e Model \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Accord\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e Year \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e2005\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e IsPrimary \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efalse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n                            \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003eId \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e Make \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Honda\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e Model \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Insight\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e Year \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e2019\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e IsPrimary \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n                            \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n                            SelectedVehicle \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e None \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"token function\"\u003einit\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e initModel\n\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e update msg model \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ematch\u003c/span\u003e msg \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e Insert \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e model \u003cspan class=\"token comment\"\u003e//TODO: Make this do something\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e Remove \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e model \u003cspan class=\"token comment\"\u003e//TODO: Make this do something\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e Modified \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epos\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e itemMessage\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e model \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e Vehicles \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eVehicles\n                                                        \u003cspan class=\"token operator\"\u003e|\u003e\u003c/span\u003e List\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emapi \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003efun\u003c/span\u003e i itemModel \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\n                                                        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e i \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e pos \u003cspan class=\"token keyword\"\u003ethen\u003c/span\u003e\n                                                            VehicleItem\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eupdate itemMessage itemModel\n                                                        \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\n                                                            itemModel\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e SelectVehicle pos \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003emodel \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e SelectedVehicle \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eSome\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eVehicles\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eItem\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epos\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e view \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eModel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e dispatch \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e items \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eVehicles \u003cspan class=\"token operator\"\u003e|\u003e\u003c/span\u003e List\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003emapi\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003efun\u003c/span\u003e pos itemModel \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\n                             VehicleItem\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eview\n                                itemModel\n                                \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003efun\u003c/span\u003e msg \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e dispatch \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eModified \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epos\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e msg\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eCollectionView\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eitems\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNow this is clearly a work in progress, but I wanted to map out where I'm heading while simultaneously getting the most simple case working first. There are three novel things that are happening here. The first is that part of the Model for this module is a list of models from the \u003ccode\u003eVehicleItem\u003c/code\u003e module. Model, module, model, module... bleh.\u003c/p\u003e\n\u003cp\u003eAnyway, the second is in \u003ccode\u003eupdate\u003c/code\u003e. You'll notice the arguments for the \u003ccode\u003eModified\u003c/code\u003e case are \u003ccode\u003epos\u003c/code\u003e (an integer representing the position of the requested item in the array - aka its index) and \u003ccode\u003eitemMessage\u003c/code\u003e which is of type \u003ccode\u003eVehicleItem.Msg\u003c/code\u003e. Those arguments are then used to update the model that matches the correct position using \u003ccode\u003eVehicleItem.update\u003c/code\u003e. So all we're doing is routing the message back to the appropriate update function so that the result is a list of updated \u003ccode\u003eVehicleItem.Model\u003c/code\u003es. And since our \u003ccode\u003eupdate\u003c/code\u003e functions are pure, we don't need a specific instance of anything, just pass the model and the message and the result will be the updated model.\u003c/p\u003e\n\u003cp\u003eThe last novel thing is in (you guessed it) the view. We get a list of items by mapping the List of \u003ccode\u003eVehicleItem.Model\u003c/code\u003e in our model to a list of Stack Layout Views via the \u003ccode\u003eVehicleItem.view\u003c/code\u003e function. There's something really interesting that we're doing here that makes this work. We're hijacking the \u003ccode\u003edispatch\u003c/code\u003e function so that the \u003ccode\u003eModified\u003c/code\u003e message gets sent instead. Its then up to our \u003ccode\u003eModified\u003c/code\u003e message to update the appropriate item (using \u003ccode\u003eVehicleItem.update\u003c/code\u003e as we previously saw).\u003c/p\u003e\n\u003cp\u003eHopefully that makes sense.\u003c/p\u003e\n\u003cp\u003eNow, you may notice that I defined a \u003ccode\u003eSelectVehicle\u003c/code\u003e message that will handle selection (and potentially navigation). I did this mostly just to work out how that might hypothetically look. It isn't used here because I realized that \u003ccode\u003eCollectionView\u003c/code\u003e requires you to wrap each item in a \u003ccode\u003eSwipeView\u003c/code\u003e, so we may have to move that logic down somehow. Or maybe not. I haven't gotten that far yet.\u003c/p\u003e\n\u003cp\u003eBack to making the simplest case work.\u003c/p\u003e\n\u003ch1\u003eWiring It All Up\u003c/h1\u003e\n\u003cp\u003eSo now that we have the Vehicle List worked out, lets tie it all together in the root \u003ccode\u003eApp\u003c/code\u003e module.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-fsharp\"\u003e\u003ccode class=\"language-fsharp\"\u003e\u003cspan class=\"token keyword\"\u003enamespace\u003c/span\u003e commutr_v2\n\n\u003cspan class=\"token keyword\"\u003eopen\u003c/span\u003e System\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eDiagnostics\n\u003cspan class=\"token keyword\"\u003eopen\u003c/span\u003e Fabulous\n\u003cspan class=\"token keyword\"\u003eopen\u003c/span\u003e Fabulous\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eXamarinForms\n\u003cspan class=\"token keyword\"\u003eopen\u003c/span\u003e Fabulous\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eXamarinForms\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eLiveUpdate\n\u003cspan class=\"token keyword\"\u003eopen\u003c/span\u003e Xamarin\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eForms\n\n\u003cspan class=\"token keyword\"\u003emodule\u003c/span\u003e App \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eModel\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e Vehicles \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eVehicleListing\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eModel\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eMsg\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e VehicleListUpdated \u003cspan class=\"token keyword\"\u003eof\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eVehicleListing\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eMsg\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e RefreshVehicles\n\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e initModel \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e Vehicles \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e VehicleListing\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003einit\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e init \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e initModel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e Cmd\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003enone\n\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e update msg model \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ematch\u003c/span\u003e msg \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e VehicleListUpdated listMsg \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003emodel \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e Vehicles \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e VehicleListing\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eupdate listMsg model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eVehicles\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e Cmd\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003enone\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e RefreshVehicles \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003emodel \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e Vehicles \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e VehicleListing\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003einit\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e Cmd\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003enone\n\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e view \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eModel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edispatch \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eDispatch\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003eMsg\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e vehicleList \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e VehicleListing\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eview\n                            model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eVehicles\n                            \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003efun\u003c/span\u003e msg \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e dispatch \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eVehicleListUpdated msg\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eContentPage\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n          content \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eStackLayout\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epadding \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Thickness \u003cspan class=\"token number\"\u003e20.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e verticalOptions \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e LayoutOptions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCenter\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            children \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n                vehicleList\n            \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e// Note, this declaration is needed if you enable LiveUpdate\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e program \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e XamarinFormsProgram\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emkProgram init update view\n\n\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eApp\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e app \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003einherit\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eApplication\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e runner \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n        App\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eprogram\n\u003cspan class=\"token preprocessor property\"\u003e#\u003cspan class=\"token directive keyword\"\u003eif\u003c/span\u003e DEBUG\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003e\u003c/span\u003e Program\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewithConsoleTrace\n\u003cspan class=\"token preprocessor property\"\u003e#\u003cspan class=\"token directive keyword\"\u003eendif\u003c/span\u003e\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003e\u003c/span\u003e XamarinFormsProgram\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erun app\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eSo this is not all that unsimilar to the \u003ccode\u003eVehicleListing\u003c/code\u003e. We make the child model part of our model and use the child's update and view logic in our own. The result isn't the prettiest, but it displays, so... a job well done?\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/posts/mvu-composition/wired-up-ui.png\" alt=\"Wired Up UI\"\u003e\u003c/p\u003e\n\u003cp\u003eClearly there are some changes that need to be made. For instance, not all the vehicle data is displayed and (to be quite frank) this UI is trash. So lets see if we can't make this thing just a little bit more appealing. The good news is this will likely involve mostly just tweaking the view code a little bit. So lets see what we can do...\u003c/p\u003e\n\u003cp\u003eWe'll change the \u003ccode\u003eview\u003c/code\u003e function of the \u003ccode\u003eVehicleListing\u003c/code\u003e to be the following:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-fsharp\"\u003e\u003ccode class=\"language-fsharp\"\u003e\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e view \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eModel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e dispatch \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n        View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eStackLayout\n            \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epadding \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Thickness \u003cspan class=\"token number\"\u003e5.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n             children \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n                 \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eFrame\n                     \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ehasShadow \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efalse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                      backgroundColor \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e AppColors\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eghostWhite\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                      padding \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Thickness \u003cspan class=\"token number\"\u003e10.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                      content \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n                          View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eFlexLayout\n                              \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emargin \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Thickness \u003cspan class=\"token number\"\u003e10.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                               verticalOptions \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e LayoutOptions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCenter\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                               horizontalOptions \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e LayoutOptions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCenter\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                               alignItems \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e FlexAlignItems\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCenter\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                               justifyContent \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e FlexJustify\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eSpaceEvenly\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                               direction \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e FlexDirection\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eRow\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                               children \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n                                   \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eSKCanvasView\n                                       \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epaintSurface \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n                                           \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003efun\u003c/span\u003e args \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\n                                               \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e info \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e args\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eInfo\n                                               \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e surface \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e args\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eSurface\n                                               \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e canvas \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e surface\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCanvas\n\n                                               canvas\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eClear\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n                                               \u003cspan class=\"token keyword\"\u003euse\u003c/span\u003e paint \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n                                                   \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eSkiaSharp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eSKPaint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eStyle \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e SkiaSharp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eSKPaintStyle\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eFill\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                                                                         Color \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n                                                                             \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eIsPrimary \u003cspan class=\"token keyword\"\u003ethen\u003c/span\u003e\n                                                                                 AppColors\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emandarin\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eToSKColor\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                                                                              \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\n                                                                                  AppColors\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esilverSandLight\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eToSKColor\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                                                                         StrokeWidth \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e5.0f\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n                                               canvas\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eDrawCircle\n                                                   \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efloat32 \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003einfo\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eWidth \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e float32 \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003einfo\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eHeight \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e10.0f\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e paint\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                                     View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eLabel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etext \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eYear\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eToString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                                     View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eLabel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etext \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eMake\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                                     View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eLabel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etext \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eModel\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNow thats quite a big difference, so lets break it down real quick.\u003c/p\u003e\n\u003cp\u003eThe basic layout is a \u003ccode\u003eStackLayout\u003c/code\u003e with a single \u003ccode\u003eFrame\u003c/code\u003e as the child. This is done so that we can create space between list elements via padding. The \u003ccode\u003eFrame\u003c/code\u003e's content is a \u003ccode\u003eFlexLayout\u003c/code\u003e which allows us to evenly space the elements horizontally. Finally, we have a dot drawn via SkiaSharp that indicates the which is the primary, along with the reast of the info for the vehicle.\u003c/p\u003e\n\u003cp\u003eThe result looks like this:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/posts/mvu-composition/spiffy-vehicle-list.png\" alt=\"Spiffy Vehicle List\"\u003e\u003c/p\u003e\n\u003cp\u003eI decided to conditionally change the color of the primary indicator instead of hiding it so that things will continue to line up. The alignment and layout isn't perfect, but it feels pretty good so I'm going to leave it alone for now and move on to something more interesting. Lets try to wire up a \u003ccode\u003eSwipeView\u003c/code\u003e so that we can swipe on individual items and mark them as primary.\u003c/p\u003e\n\u003ch1\u003eToggle Primary\u003c/h1\u003e\n\u003cp\u003eSo before we get into the code that changed, I want to say that this was really quite painless to set up. In fact, most of the changes I've made were more improvments than they were \"making it work\". This is largely due to the nature of MVU. Since I spent a little bit of time mapping out what updates I wanted, the logic required to update the model was already there, it just took a little bit of work to finish putting it together. That being said lets dive in.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-fsharp\"\u003e\u003ccode class=\"language-fsharp\"\u003e\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e update msg model \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ematch\u003c/span\u003e msg \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e Insert \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e model \u003cspan class=\"token comment\"\u003e//TODO: Make this do something\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e Remove \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e model \u003cspan class=\"token comment\"\u003e//TODO: Make this do something\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e Modified \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epos\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e itemMessage\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003ematch\u003c/span\u003e itemMessage \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e\n            \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e VehicleItem\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eMsg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eTogglePrimary isPrimary \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\n                \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e model \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e\n                      Vehicles \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n                          model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eVehicles\n                          \u003cspan class=\"token operator\"\u003e|\u003e\u003c/span\u003e List\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emapi \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003efun\u003c/span\u003e i itemModel \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\n                              \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e i \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e pos \u003cspan class=\"token keyword\"\u003ethen\u003c/span\u003e\n                                  VehicleItem\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eupdate itemMessage itemModel\n                              \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\n                                  \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e isPrimary \u003cspan class=\"token operator\"\u003e\u0026#x26;\u0026#x26;\u003c/span\u003e itemModel\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eIsPrimary\n                                   \u003cspan class=\"token keyword\"\u003ethen\u003c/span\u003e VehicleItem\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eupdate \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eVehicleItem\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eTogglePrimary\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003efalse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e itemModel\n                                   \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e itemModel\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e SelectVehicle pos \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e model \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e\n                  SelectedVehicle \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eSome\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eVehicles\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eItem\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epos\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e view \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eModel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e dispatch \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e items \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n            model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eVehicles\n            \u003cspan class=\"token operator\"\u003e|\u003e\u003c/span\u003e List\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emapi \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003efun\u003c/span\u003e pos itemModel \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\n                View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eSwipeView\n                    \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ebackgroundColor \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e AppColors\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esilverSandLight\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                     rightItems \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n                         View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eSwipeItems\n                             \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eitems \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n                                 \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eSwipeItem\n                                     \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etext \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enot\u003c/span\u003e itemModel\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eIsPrimary \u003cspan class=\"token keyword\"\u003ethen\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Primary\"\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Not Primary\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                                      backgroundColor \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n                                          \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enot\u003c/span\u003e itemModel\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eIsPrimary \u003cspan class=\"token keyword\"\u003ethen\u003c/span\u003e\n                                              AppColors\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emandarin\n                                           \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\n                                               AppColors\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esilverSandMediumDark\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                                      command \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n                                          \u003cspan class=\"token keyword\"\u003efun\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\n                                              dispatch\n                                                  \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003eModified\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epos\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e VehicleItem\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eTogglePrimary\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003enot\u003c/span\u003e itemModel\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eIsPrimary\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                     content \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e VehicleItem\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eview itemModel \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003efun\u003c/span\u003e msg \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e dispatch \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003eModified\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epos\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e msg\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n        View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eCollectionView\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eitems\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eLet's start by looking at the \u003ccode\u003eview\u003c/code\u003e function. Instead of mapping our \u003ccode\u003eVehicleItem.Model\u003c/code\u003e's directly to their \u003ccode\u003eview\u003c/code\u003e function, we wrap them in a \u003ccode\u003eSwipeView\u003c/code\u003e. I think it would have also been feasible to implement the swipe view one step down in the body of \u003ccode\u003eVehicleItem.view\u003c/code\u003e, but it felt right to keep \u003ccode\u003eVehicleItem\u003c/code\u003e to strictly displaying the Vehicle information.\u003c/p\u003e\n\u003cp\u003eYou'll notice that the \u003ccode\u003eSwipeView\u003c/code\u003e contains a \u003ccode\u003eSwipeItem\u003c/code\u003e which has some conditional rendering of the text and background color. This is just so that we can distinguish between adding and removing the \"Primary\" status. I used the \u003ccode\u003eSwipeItem\u003c/code\u003e's command property to fire dispatch and send the appropriate message. Really and truly, I realized that my \u003ccode\u003eModified\u003c/code\u003e message handling is a bit more complicated than it needs to be right now. This is because I'm assuming that \u003ccode\u003eVehicleItem\u003c/code\u003e will eventually require additional messages (for things like updating the Make, Model) and that that logic will need to be \u003cem\u003edifferent\u003c/em\u003e from the logic that handles IsPrimary.\u003c/p\u003e\n\u003cp\u003eThis is primarily for two different reasons. One is that only one vehicle can have \"Primary\" status at a time, so if \"Primary\" status changes for one vehicle, it \u003cem\u003emay\u003c/em\u003e affect the others (this is reflected in the \u003ccode\u003eupdate\u003c/code\u003e function, but we'll get to that in a minute). This is simply not true of other properties like Make, Model, and Year.\u003c/p\u003e\n\u003cp\u003eThe second reason is actually not visible in the above code. There is a small change I made to \u003ccode\u003eVehicleItem\u003c/code\u003e, which basically amounts to forcing SkiaSharp to redraw the little circles on every update. This is fine for right now, because the only reason \u003ccode\u003eVehicleItem.update\u003c/code\u003e is called at the moment is to change \u003ccode\u003eIsPrimary\u003c/code\u003e which requires a redraw of the dot. However, as we add other messages, we will need to make sure we don't redraw on every update as this will result in performance hits.\u003c/p\u003e\n\u003cp\u003eSo this is where we are UI-wise:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/posts/mvu-composition/mark-primary.gif\" alt=\"Mark Primary UI\"\u003e\u003c/p\u003e\n\u003cp\u003eYou'll notice that selecting one as Primary makes the other not primary (if it already was). This logic is handled in our \u003ccode\u003eupdate\u003c/code\u003e function. Our \u003ccode\u003eModified\u003c/code\u003e message contains the position and the \u003ccode\u003eVehicleItem.Msg\u003c/code\u003e we want to pass on to \u003ccode\u003eVehicleItem.update\u003c/code\u003e. Now we could for the time being have made \u003ccode\u003eModified\u003c/code\u003e to contain the \u003ccode\u003eTogglePrimary\u003c/code\u003e message instead of any \u003ccode\u003eVehicleItem.Msg\u003c/code\u003e, because for now that's the only message that \u003ccode\u003eVehicleItem\u003c/code\u003e has, but as I said earlier, this will allow us to handle future scenarios where we want to edit other information. So we pattern match on \u003ccode\u003eitemMessage\u003c/code\u003e and handle the only existing case (where \u003ccode\u003eitemMessage\u003c/code\u003e is the \u003ccode\u003eTogglePrimary\u003c/code\u003e message).\u003c/p\u003e\n\u003cp\u003eWe are also no longer simply calling \u003ccode\u003eVehicleItem.update\u003c/code\u003e on the item that matches the position we were given. We're also checking if we're setting a new item as Primary and mark any other items that are currently \"Primary\" to false. This will ensure that only one item is ever marked as Primary at a time.\u003c/p\u003e\n\u003cp\u003eBefore we wrap things up, I want to mention that I \u003cem\u003ethink\u003c/em\u003e this validates my assumption that we can handle \"Selecting\" a particular vehicle item within \u003ccode\u003eVehicleListing\u003c/code\u003e. We should be able to call dispatch to send a selection message from a \u003ccode\u003eSwipeItem\u003c/code\u003e.\u003c/p\u003e\n\u003ch1\u003eWrapping Up\u003c/h1\u003e\n\u003cp\u003eSo I think this is the state I'll leave the app in for the purposes of this article. I think it gives a pretty good idea of how composition in MVU can allow us to break out parts of the UI into smaller units. So I guess the question is, what did we learn from this?\u003c/p\u003e\n\u003cp\u003eMy first big take away is that this architecture is so straight forward that it was fairly easy for me to do a lot of planning ahead without really having a super great understanding of how all the pieces would fit together. For instance, I was pleasantly surprised by how decisions I made when creating \u003ccode\u003eVehicleItem\u003c/code\u003e panned out when connecting them to \u003ccode\u003eVehicleListing\u003c/code\u003e. The simplicity of this framework really does allow you to think clearly and accurately about what changes should and will occur to the model as well as what the resulting UI will look like.\u003c/p\u003e\n\u003cp\u003eI will note that I did not do any Commanding, which I think will complicate matters when it is needed, but the beautify of this framework is that its not necessary so far, so I didn't have to use it.\u003c/p\u003e\n\u003cp\u003eI'd also like to take this time to mention that I did have certain struggles with using additional libraries. One thing I've come to realize is that there isn't a lot of documentation for Fabulous and that examples of F# code in general are hard to find. This can make it difficult to learn, but also frustrating for someone who is used to being able to \"just read the docs\".\u003c/p\u003e\n\u003cp\u003eAnother thing I'd like to note is that quite frankly, 3rd party support for F# in Xamarin.Forms basically does not exist. I had wanted to use Sharpnado's MaterialFrame so I could get the Acrylic look, but quickly found out that MaterialFrame is built to be used strictly in XAML. This was a bit disappointing, but ultimately not a big deal. My hope is that with .NET MAUI, we'll start to see some of these UI tools become more \"Functional Friendly\" with built in support that goes beyond data binding and MVVM.\u003c/p\u003e\n\u003cp\u003eI do plan to continue working on this project, but I think this will be my last blog on it for a while. I need to spend some more time digging in to F# and MVU so that I can really understand it and find some interesting ways to use it, before I can share any more insights.\u003c/p\u003e\n\u003cp\u003eIn the meantime, go give us some listens and feel free to reach out in the comments below, on Twitter \u003ca href=\"twitter.com/usecasepod\"\u003e@usecasepod\u003c/a\u003e, or \u003ca href=\"mailto:usecasepod@gmail.com\"\u003evia email (usecasepod@gmail.com)\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eYou can also find the full repository for this app \u003ca href=\"https://github.com/usecasepod/commutr_v2\"\u003eon our Github\u003c/a\u003e, but keep in mind that this is going to be a living project, so what you see in this post today may not be reflected in the current version of the app.\u003c/p\u003e\n","author":"Austin Webre","title":"Exploring MVU Part 2: Composition","categories":["Posts"]}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"2020-05-24-mvu-composition"},"buildId":"d-rhNPmEhgDySy-i2oJSD","assetPrefix":"/nextjs-blog","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>