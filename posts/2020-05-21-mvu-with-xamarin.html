<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png"/><link rel="manifest" href="/favicons/site.webmanifest"/><link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicons/favicon.ico"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-config" content="/favicons/browserconfig.xml"/><meta name="theme-color" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="description" content="A statically generated blog example using Next.js and Markdown."/><meta property="og:image" content="https://og-image.vercel.app/Next.js%20Blog%20Starter%20Example.png?theme=light&amp;md=1&amp;fontSize=100px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fnextjs-black-logo.svg"/><title>Use Case Podcast | Exploring MVU and Functional Paradigms in Xamarin.Forms</title><meta name="next-head-count" content="15"/><link rel="preload" href="/nextjs-blog/_next/static/css/04c36957bfce90ec.css" as="style"/><link rel="stylesheet" href="/nextjs-blog/_next/static/css/04c36957bfce90ec.css" data-n-g=""/><link rel="preload" href="/nextjs-blog/_next/static/css/cf121497002c184d.css" as="style"/><link rel="stylesheet" href="/nextjs-blog/_next/static/css/cf121497002c184d.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/nextjs-blog/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/nextjs-blog/_next/static/chunks/webpack-82f8a2871b20f95a.js" defer=""></script><script src="/nextjs-blog/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/nextjs-blog/_next/static/chunks/main-a0853fbc3d9f629b.js" defer=""></script><script src="/nextjs-blog/_next/static/chunks/pages/_app-ff4c1a49d0216aaf.js" defer=""></script><script src="/nextjs-blog/_next/static/chunks/395-2f815b82730b0109.js" defer=""></script><script src="/nextjs-blog/_next/static/chunks/pages/posts/%5Bslug%5D-22407fa313a89635.js" defer=""></script><script src="/nextjs-blog/_next/static/462EShwFYaOEnlIebvUk7/_buildManifest.js" defer=""></script><script src="/nextjs-blog/_next/static/462EShwFYaOEnlIebvUk7/_ssgManifest.js" defer=""></script><script src="/nextjs-blog/_next/static/462EShwFYaOEnlIebvUk7/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="min-h-screen"><main><div class="container mx-auto px-5"><h2 class="text-2xl md:text-4xl font-bold tracking-tight md:tracking-tighter leading-tight mb-20 mt-8"><a class="hover:underline" href="/">Posts</a>.</h2><article class="mb-32"><h1 class="text-6xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-left">Exploring MVU and Functional Paradigms in Xamarin.Forms</h1><div class="hidden md:block md:mb-12"><div class="flex items-center"><div class="text-xl font-bold">Austin Webre</div></div></div><div class="max-w-2xl mx-auto"><div class="block md:hidden mb-6"><div class="flex items-center"><div class="text-xl font-bold">Austin Webre</div></div></div><div class="mb-6 text-lg"><time dateTime="2020-05-21">May	21, 2020</time></div></div><div class="max-w-2xl mx-auto"><div class="markdown-styles_markdown__h_8de"><p>This week saw one of Microsoft's biggest conferences transition to a completely online format. We won't discuss the fact that this year's conference was <strong>supposed</strong> to be held just 30 minutes from my house and that I was hoping to attend, but I do want to talk a bit about some of this year's announcements in the .NET space that have taken over my brain. There's plenty to be excited about - <a href="https://azure.microsoft.com/en-us/blog/azure-analytics-clarity-in-an-instant/">new Azure services</a>, <a href="https://visualstudiomagazine.com/articles/2020/05/19/blazor-webassembly-3-2.aspx">production-ready (?) Blazor</a>, <a href="https://devblogs.microsoft.com/dotnet/announcing-net-5-preview-4-and-our-journey-to-one-net/">.NET Core 4 - err... I mean .NET 5</a> - but what has really monopolized my thinking is how functional concepts keep making their way into C#.</p>
<p>I found this in two distinct efforts that were mentioned at this year's Build. The more obvious of the two is the <a href="https://devblogs.microsoft.com/dotnet/welcome-to-c-9-0/">addition of Records and Init-only Properties in C# 9.0</a>. This, along with some nice improvments to pattern matching, will mean that C# devs will be able to reap some more of the performance and readability benefits of a more Functional approach. The second place, was with the introduction of a technology that is still a year out from its first GA version: <a href="https://devblogs.microsoft.com/dotnet/introducing-net-multi-platform-app-ui/">.NET MAUI (Multi-platform App UI)</a>. The idea here is to finally unify the split Xamarin/UWP experiences into a single developer experience. Now, this on its own is really cool (<strong><em>IOS, ANDROID, AND WINDOWS ALL IN THE SAME PROJECT?!?! GASP</em></strong>), but they snuck something in here that again appears to point towards Functional paradigms coming enmasse to C#-land, namely, first class support for MVU (Model-View-Update).</p>
<p>Now C# devs are really familiar with M's and V's - we're all about MVC and MVVM - but I don't think very many of us are familiar with MVU. I've heard it discussed by people who have their toes in the Functional world, but never really dug in. In fact, I've always wanted to be one of those people that has their toes in the Functional world, but I've always given up long before I understood anything in a real sense. So I've convinced myself to give it another try, but this time in the hopes that I might get some insight into the future of mobile development on the .NET platform.</p>
<p>So that's the plan (and the purpose of this article - only took me 3 paragraphs to get to it).
I'm going to use F# and Xamarin.Forms to try out MVU in the hopes that I might gain some insight into what MAUI may bring.</p>
<p>This may be a completely foolish attempt, but I think it has the highest possibility of getting me to actually try my hand at F#. Worst case, you'll never see this, because I'll never post it. Its a perfect system.</p>
<h1>Fabulous F# and Xamarin.Forms</h1>
<p>Anyway, I started by doing some googling for MVU frameworks meant to work with Xamarin.Forms and within seconds I had run into <a href="https://github.com/fsprojects/Fabulous/tree/master/Fabulous.XamarinForms">Fabulous for Xamarin.Forms</a>. It looked like everything I needed, including a template project - which was a real plus. I won't bore you with the setup, just know that it was minimal (a couple of dotnet CLI commands) and that it resulted in this:
<img src="/assets/posts/mvu-with-xamarin/solution-tree.png" alt="Solution Tree"></p>
<p>Thats right folks, three F# projects, no XAML, and no C#.</p>
<blockquote>
<h4>Side Note: Project Name</h4>
<p>You may be questioning why this project name is not "MvuDemo" or "HelleWorldMvu" or something. My plan is to ultimately recreate an app that I wrote a few years ago, which I use for mileage and fuel economy tracking. While its not important to this particular post, I figured I'd let you all in on this little personality tick of mine. When I start a project of any kind, I start with an end goal so large its impossible.</p>
<p>There's a good chance <em>commutrv2</em> will never actually happen. When I first started this post, I assumed I would be able to get well beyond explaining the demo app. I quickly realized I needed to break down the demo app just so that I could understand it. So there you have it. When it comes to personal goals, I <em>always</em> over promise and under deliver.</p>
</blockquote>
<p>Was that a waste of your time? I hope not ... now where were we?</p>
<p>Oh right, here's the contents of the single F# file generated in the shared project:</p>
<div class="remark-highlight"><pre class="language-fsharp"><code class="language-fsharp"><span class="token comment">// Copyright 2018-2019 Fabulous contributors. See LICENSE.md for license.</span>
<span class="token keyword">namespace</span> commutr_v2

<span class="token keyword">open</span> System<span class="token punctuation">.</span>Diagnostics
<span class="token keyword">open</span> Fabulous
<span class="token keyword">open</span> Fabulous<span class="token punctuation">.</span>XamarinForms
<span class="token keyword">open</span> Fabulous<span class="token punctuation">.</span>XamarinForms<span class="token punctuation">.</span>LiveUpdate
<span class="token keyword">open</span> Xamarin<span class="token punctuation">.</span>Forms

<span class="token keyword">module</span> App <span class="token operator">=</span>
    <span class="token keyword">type</span> <span class="token class-name">Model</span> <span class="token operator">=</span>
      <span class="token punctuation">{</span> Count <span class="token punctuation">:</span> <span class="token class-name">int</span>
        Step <span class="token punctuation">:</span> <span class="token class-name">int</span>
        TimerOn<span class="token punctuation">:</span> <span class="token class-name">bool</span> <span class="token punctuation">}</span>

    <span class="token keyword">type</span> <span class="token class-name">Msg</span> <span class="token operator">=</span>
        <span class="token operator">|</span> Increment
        <span class="token operator">|</span> Decrement
        <span class="token operator">|</span> Reset
        <span class="token operator">|</span> SetStep <span class="token keyword">of</span> <span class="token class-name">int</span>
        <span class="token operator">|</span> TimerToggled <span class="token keyword">of</span> <span class="token class-name">bool</span>
        <span class="token operator">|</span> TimedTick

    <span class="token keyword">let</span> initModel <span class="token operator">=</span> <span class="token punctuation">{</span> Count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> Step <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> TimerOn<span class="token operator">=</span><span class="token keyword">false</span> <span class="token punctuation">}</span>

    <span class="token keyword">let</span> init <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> initModel<span class="token punctuation">,</span> Cmd<span class="token punctuation">.</span>none

    <span class="token keyword">let</span> timerCmd <span class="token operator">=</span>
        <span class="token computation-expression keyword">async</span> <span class="token punctuation">{</span> <span class="token keyword">do</span><span class="token operator">!</span> Async<span class="token punctuation">.</span>Sleep <span class="token number">200</span>
                <span class="token keyword">return</span> TimedTick <span class="token punctuation">}</span>
        <span class="token operator">|></span> Cmd<span class="token punctuation">.</span>ofAsyncMsg

    <span class="token keyword">let</span> update msg model <span class="token operator">=</span>
        <span class="token keyword">match</span> msg <span class="token keyword">with</span>
        <span class="token operator">|</span> Increment <span class="token operator">-></span> <span class="token punctuation">{</span> model <span class="token keyword">with</span> Count <span class="token operator">=</span> model<span class="token punctuation">.</span>Count <span class="token operator">+</span> model<span class="token punctuation">.</span>Step <span class="token punctuation">}</span><span class="token punctuation">,</span> Cmd<span class="token punctuation">.</span>none
        <span class="token operator">|</span> Decrement <span class="token operator">-></span> <span class="token punctuation">{</span> model <span class="token keyword">with</span> Count <span class="token operator">=</span> model<span class="token punctuation">.</span>Count <span class="token operator">-</span> model<span class="token punctuation">.</span>Step <span class="token punctuation">}</span><span class="token punctuation">,</span> Cmd<span class="token punctuation">.</span>none
        <span class="token operator">|</span> Reset <span class="token operator">-></span> init <span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token operator">|</span> SetStep n <span class="token operator">-></span> <span class="token punctuation">{</span> model <span class="token keyword">with</span> Step <span class="token operator">=</span> n <span class="token punctuation">}</span><span class="token punctuation">,</span> Cmd<span class="token punctuation">.</span>none
        <span class="token operator">|</span> TimerToggled on <span class="token operator">-></span> <span class="token punctuation">{</span> model <span class="token keyword">with</span> TimerOn <span class="token operator">=</span> on <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">if</span> on <span class="token keyword">then</span> timerCmd <span class="token keyword">else</span> Cmd<span class="token punctuation">.</span>none<span class="token punctuation">)</span>
        <span class="token operator">|</span> TimedTick <span class="token operator">-></span>
            <span class="token keyword">if</span> model<span class="token punctuation">.</span>TimerOn <span class="token keyword">then</span>
                <span class="token punctuation">{</span> model <span class="token keyword">with</span> Count <span class="token operator">=</span> model<span class="token punctuation">.</span>Count <span class="token operator">+</span> model<span class="token punctuation">.</span>Step <span class="token punctuation">}</span><span class="token punctuation">,</span> timerCmd
            <span class="token keyword">else</span>
                model<span class="token punctuation">,</span> Cmd<span class="token punctuation">.</span>none

    <span class="token keyword">let</span> view <span class="token punctuation">(</span>model<span class="token punctuation">:</span> <span class="token class-name">Model</span><span class="token punctuation">)</span> dispatch <span class="token operator">=</span>
        View<span class="token punctuation">.</span><span class="token function">ContentPage</span><span class="token punctuation">(</span>
          content <span class="token operator">=</span> View<span class="token punctuation">.</span><span class="token function">StackLayout</span><span class="token punctuation">(</span>padding <span class="token operator">=</span> Thickness <span class="token number">20.0</span><span class="token punctuation">,</span> verticalOptions <span class="token operator">=</span> LayoutOptions<span class="token punctuation">.</span>Center<span class="token punctuation">,</span>
            children <span class="token operator">=</span> <span class="token punctuation">[</span>
                View<span class="token punctuation">.</span><span class="token function">Label</span><span class="token punctuation">(</span>text <span class="token operator">=</span> sprintf <span class="token string">"%d"</span> model<span class="token punctuation">.</span>Count<span class="token punctuation">,</span> horizontalOptions <span class="token operator">=</span> LayoutOptions<span class="token punctuation">.</span>Center<span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">200.0</span><span class="token punctuation">,</span> horizontalTextAlignment<span class="token operator">=</span>TextAlignment<span class="token punctuation">.</span>Center<span class="token punctuation">)</span>
                View<span class="token punctuation">.</span><span class="token function">Button</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string">"Increment"</span><span class="token punctuation">,</span> command <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">fun</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> dispatch Increment<span class="token punctuation">)</span><span class="token punctuation">,</span> horizontalOptions <span class="token operator">=</span> LayoutOptions<span class="token punctuation">.</span>Center<span class="token punctuation">)</span>
                View<span class="token punctuation">.</span><span class="token function">Button</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string">"Decrement"</span><span class="token punctuation">,</span> command <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">fun</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> dispatch Decrement<span class="token punctuation">)</span><span class="token punctuation">,</span> horizontalOptions <span class="token operator">=</span> LayoutOptions<span class="token punctuation">.</span>Center<span class="token punctuation">)</span>
                View<span class="token punctuation">.</span><span class="token function">Label</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string">"Timer"</span><span class="token punctuation">,</span> horizontalOptions <span class="token operator">=</span> LayoutOptions<span class="token punctuation">.</span>Center<span class="token punctuation">)</span>
                View<span class="token punctuation">.</span><span class="token function">Switch</span><span class="token punctuation">(</span>isToggled <span class="token operator">=</span> model<span class="token punctuation">.</span>TimerOn<span class="token punctuation">,</span> toggled <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">fun</span> on <span class="token operator">-></span> dispatch <span class="token punctuation">(</span>TimerToggled on<span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> horizontalOptions <span class="token operator">=</span> LayoutOptions<span class="token punctuation">.</span>Center<span class="token punctuation">)</span>
                View<span class="token punctuation">.</span><span class="token function">Slider</span><span class="token punctuation">(</span>minimumMaximum <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value <span class="token operator">=</span> double model<span class="token punctuation">.</span>Step<span class="token punctuation">,</span> valueChanged <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">fun</span> args <span class="token operator">-></span> dispatch <span class="token punctuation">(</span>SetStep <span class="token punctuation">(</span>int <span class="token punctuation">(</span>args<span class="token punctuation">.</span>NewValue <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> horizontalOptions <span class="token operator">=</span> LayoutOptions<span class="token punctuation">.</span>FillAndExpand<span class="token punctuation">)</span>
                View<span class="token punctuation">.</span><span class="token function">Label</span><span class="token punctuation">(</span>text <span class="token operator">=</span> sprintf <span class="token string">"Step size: %d"</span> model<span class="token punctuation">.</span>Step<span class="token punctuation">,</span> horizontalOptions <span class="token operator">=</span> LayoutOptions<span class="token punctuation">.</span>Center<span class="token punctuation">)</span>
                View<span class="token punctuation">.</span><span class="token function">Button</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string">"Reset"</span><span class="token punctuation">,</span> horizontalOptions <span class="token operator">=</span> LayoutOptions<span class="token punctuation">.</span>Center<span class="token punctuation">,</span> command <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">fun</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> dispatch Reset<span class="token punctuation">)</span><span class="token punctuation">,</span> commandCanExecute <span class="token operator">=</span> <span class="token punctuation">(</span>model <span class="token operator">&#x3C;></span> initModel<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">// Note, this declaration is needed if you enable LiveUpdate</span>
    <span class="token keyword">let</span> program <span class="token operator">=</span> XamarinFormsProgram<span class="token punctuation">.</span>mkProgram init update view

<span class="token keyword">type</span> <span class="token class-name">App</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> app <span class="token operator">=</span>
    <span class="token keyword">inherit</span> <span class="token class-name">Application</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">let</span> runner <span class="token operator">=</span>
        App<span class="token punctuation">.</span>program
<span class="token preprocessor property">#<span class="token directive keyword">if</span> DEBUG</span>
        <span class="token operator">|></span> Program<span class="token punctuation">.</span>withConsoleTrace
<span class="token preprocessor property">#<span class="token directive keyword">endif</span></span>
        <span class="token operator">|></span> XamarinFormsProgram<span class="token punctuation">.</span>run app

<span class="token preprocessor property">#<span class="token directive keyword">if</span> DEBUG</span>
    <span class="token comment">// Uncomment this line to enable live update in debug mode.</span>
    <span class="token comment">// See https://fsprojects.github.io/Fabulous/Fabulous.XamarinForms/tools.html#live-update for further  instructions.</span>
    <span class="token comment">//</span>
    <span class="token keyword">do</span> runner<span class="token punctuation">.</span><span class="token function">EnableLiveUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token preprocessor property">#<span class="token directive keyword">endif</span></span>

    <span class="token comment">// Uncomment this code to save the application state to app.Properties using Newtonsoft.Json</span>
    <span class="token comment">// See https://fsprojects.github.io/Fabulous/Fabulous.XamarinForms/models.html#saving-application-state for further  instructions.</span>
<span class="token preprocessor property">#<span class="token directive keyword">if</span> APPSAVE</span>
    <span class="token keyword">let</span> modelId <span class="token operator">=</span> <span class="token string">"model"</span>
    <span class="token keyword">override</span> __<span class="token punctuation">.</span><span class="token function">OnSleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span>

        <span class="token keyword">let</span> json <span class="token operator">=</span> Newtonsoft<span class="token punctuation">.</span>Json<span class="token punctuation">.</span>JsonConvert<span class="token punctuation">.</span><span class="token function">SerializeObject</span><span class="token punctuation">(</span>runner<span class="token punctuation">.</span>CurrentModel<span class="token punctuation">)</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"OnSleep: saving model into app.Properties, json = {0}"</span><span class="token punctuation">,</span> json<span class="token punctuation">)</span>

        app<span class="token punctuation">.</span>Properties<span class="token punctuation">.</span><span class="token punctuation">[</span>modelId<span class="token punctuation">]</span> <span class="token operator">&#x3C;-</span> json

    <span class="token keyword">override</span> __<span class="token punctuation">.</span><span class="token function">OnResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span>
        Console<span class="token punctuation">.</span>WriteLine <span class="token string">"OnResume: checking for model in app.Properties"</span>
        <span class="token keyword">try</span>
            <span class="token keyword">match</span> app<span class="token punctuation">.</span>Properties<span class="token punctuation">.</span>TryGetValue modelId <span class="token keyword">with</span>
            <span class="token operator">|</span> <span class="token keyword">true</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">:?</span> string <span class="token keyword">as</span> json<span class="token punctuation">)</span> <span class="token operator">-></span>

                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"OnResume: restoring model from app.Properties, json = {0}"</span><span class="token punctuation">,</span> json<span class="token punctuation">)</span>
                <span class="token keyword">let</span> model <span class="token operator">=</span> Newtonsoft<span class="token punctuation">.</span>Json<span class="token punctuation">.</span>JsonConvert<span class="token punctuation">.</span>DeserializeObject<span class="token operator">&#x3C;</span>App<span class="token punctuation">.</span>Model<span class="token operator">></span><span class="token punctuation">(</span>json<span class="token punctuation">)</span>

                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"OnResume: restoring model from app.Properties, model = {0}"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>sprintf <span class="token string">"%0A"</span> model<span class="token punctuation">)</span><span class="token punctuation">)</span>
                runner<span class="token punctuation">.</span>SetCurrentModel <span class="token punctuation">(</span>model<span class="token punctuation">,</span> Cmd<span class="token punctuation">.</span>none<span class="token punctuation">)</span>

            <span class="token operator">|</span> _ <span class="token operator">-></span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">with</span> ex <span class="token operator">-></span>
            App<span class="token punctuation">.</span>program<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span><span class="token string">"Error while restoring model found in app.Properties"</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span>

    <span class="token keyword">override</span> this<span class="token punctuation">.</span><span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span>
        Console<span class="token punctuation">.</span>WriteLine <span class="token string">"OnStart: using same logic as OnResume()"</span>
        this<span class="token punctuation">.</span><span class="token function">OnResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token preprocessor property">#<span class="token directive keyword">endif</span></span>
</code></pre></div>
<p>This is a pretty complicated example to start with, and it took me a little bit by surprise. But the gist of this example is that it is a counter, with a slider to adjust the "step" of the increment, and an optional timer feature which increments the count by the step amount every 200ms. Here's the UI to help you picture it.</p>
<p><img src="/assets/posts/mvu-with-xamarin/initial-example-screenshot.png" alt="(Initial Example Screenshot)"></p>
<blockquote>
<h4>Side Note: Acknowledging My Own Limits</h4>
<p>Just as a note, we're going to skip everything from <code>let program = XamarinFormsProgram.mkProgram init update view</code> down as this is really just kind of "wiring" that sets up the framework. I included it here as it is part of the file and might be interesting for those who are a little more advanced in their knowledge of F# Xamarin development, but - to be truthfully honest - I don't understand most of it.</p>
</blockquote>
<h1>Breaking It Down</h1>
<p>Now I know there's a lot of code here and on top of that, there's quite a bit of syntax that looks quite strange if you're not familiar with F#, but there's really three key portions of this app that I think break down quite nicely. I know what you're thinking, "Three you say? You mean the same as the number of letters in the acronym?" And you're right, but you don't have to be so smug about it.</p>
<h2>First: The Model (and the Initialization Thereof)</h2>
<div class="remark-highlight"><pre class="language-fsharp"><code class="language-fsharp"><span class="token keyword">type</span> <span class="token class-name">Model</span> <span class="token operator">=</span>
      <span class="token punctuation">{</span> Count <span class="token punctuation">:</span> <span class="token class-name">int</span>
        Step <span class="token punctuation">:</span> <span class="token class-name">int</span>
        TimerOn<span class="token punctuation">:</span> <span class="token class-name">bool</span> <span class="token punctuation">}</span>

    <span class="token keyword">type</span> <span class="token class-name">Msg</span> <span class="token operator">=</span>
        <span class="token operator">|</span> Increment
        <span class="token operator">|</span> Decrement
        <span class="token operator">|</span> Reset
        <span class="token operator">|</span> SetStep <span class="token keyword">of</span> <span class="token class-name">int</span>
        <span class="token operator">|</span> TimerToggled <span class="token keyword">of</span> <span class="token class-name">bool</span>
        <span class="token operator">|</span> TimedTick

    <span class="token keyword">let</span> initModel <span class="token operator">=</span> <span class="token punctuation">{</span> Count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> Step <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> TimerOn<span class="token operator">=</span><span class="token keyword">false</span> <span class="token punctuation">}</span>

    <span class="token keyword">let</span> init <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> initModel<span class="token punctuation">,</span> Cmd<span class="token punctuation">.</span>none
</code></pre></div>
<p>In the above, we have two types. One is a record representing the data that will drive the app, and we've decided to call it <code>Model</code> (because its... the model). But the second one is actually what we call a Discriminated Union. The best description I've heard so far of Discriminated Unions is that they're "enums on steroids". They are similar to an enum where each value can be an "object" and they're really powerful. Anyway, all that syntax aside, this Discriminated Union is what we call the message. The importance of the message is that it tells us how the model should change. For those familiar with tools like ReactRedux, the message is similar to your action.</p>
<p>Next we have two <code>let</code> statements. The first describes the initial state. Notice that we do not specify that it is of the <code>Model</code> type, because types are inferred in F#. Its magic and its a lot less typing, and I'm not sure if I love it or hate it. The second let statement is essential, it is a function that returns the intial state (which we created in the previous statement) and a command. Commands are another key concept in MVU.</p>
<p>As I understand it, the key reason for having commands is that they allow us to fire messages from within the update function (which we will discuss in more detail later). But there are several different kinds of commands which can be used to fire messages in different kinds of ways.The one you'll see used in this example is <code>Cmd.ofAsyncMsg</code>. TThis command allow asynchrous messages to be piped in to our update function, which allows us to complete asynchronous tasks like waiting on a timer, making a database call, or issuing and resolving a REST request. I'm skipping ahead a bit here, but this should make more sense in a minute.</p>
<p>So there we have it, the model, the message, and our initalizer.</p>
<h2>Next Up: Our Update Function</h2>
<div class="remark-highlight"><pre class="language-fsharp"><code class="language-fsharp"><span class="token keyword">let</span> timerCmd <span class="token operator">=</span>
        <span class="token computation-expression keyword">async</span> <span class="token punctuation">{</span> <span class="token keyword">do</span><span class="token operator">!</span> Async<span class="token punctuation">.</span>Sleep <span class="token number">200</span>
                <span class="token keyword">return</span> TimedTick <span class="token punctuation">}</span>
        <span class="token operator">|></span> Cmd<span class="token punctuation">.</span>ofAsyncMsg

    <span class="token keyword">let</span> update msg model <span class="token operator">=</span>
        <span class="token keyword">match</span> msg <span class="token keyword">with</span>
        <span class="token operator">|</span> Increment <span class="token operator">-></span> <span class="token punctuation">{</span> model <span class="token keyword">with</span> Count <span class="token operator">=</span> model<span class="token punctuation">.</span>Count <span class="token operator">+</span> model<span class="token punctuation">.</span>Step <span class="token punctuation">}</span><span class="token punctuation">,</span> Cmd<span class="token punctuation">.</span>none
        <span class="token operator">|</span> Decrement <span class="token operator">-></span> <span class="token punctuation">{</span> model <span class="token keyword">with</span> Count <span class="token operator">=</span> model<span class="token punctuation">.</span>Count <span class="token operator">-</span> model<span class="token punctuation">.</span>Step <span class="token punctuation">}</span><span class="token punctuation">,</span> Cmd<span class="token punctuation">.</span>none
        <span class="token operator">|</span> Reset <span class="token operator">-></span> init <span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token operator">|</span> SetStep n <span class="token operator">-></span> <span class="token punctuation">{</span> model <span class="token keyword">with</span> Step <span class="token operator">=</span> n <span class="token punctuation">}</span><span class="token punctuation">,</span> Cmd<span class="token punctuation">.</span>none
        <span class="token operator">|</span> TimerToggled on <span class="token operator">-></span> <span class="token punctuation">{</span> model <span class="token keyword">with</span> TimerOn <span class="token operator">=</span> on <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">if</span> on <span class="token keyword">then</span> timerCmd <span class="token keyword">else</span> Cmd<span class="token punctuation">.</span>none<span class="token punctuation">)</span>
        <span class="token operator">|</span> TimedTick <span class="token operator">-></span>
            <span class="token keyword">if</span> model<span class="token punctuation">.</span>TimerOn <span class="token keyword">then</span>
                <span class="token punctuation">{</span> model <span class="token keyword">with</span> Count <span class="token operator">=</span> model<span class="token punctuation">.</span>Count <span class="token operator">+</span> model<span class="token punctuation">.</span>Step <span class="token punctuation">}</span><span class="token punctuation">,</span> timerCmd
            <span class="token keyword">else</span>
                model<span class="token punctuation">,</span> Cmd<span class="token punctuation">.</span>none
</code></pre></div>
<p>So in the above, we only have two statements. <code>timerCmd</code> is an asynchronous function which waits 200ms before returning a <code>TimedTick</code>, which you may recall was one of the cases in our Discriminated Union. This is then piped into an async message command, which will issue the <code>TimedTick</code> message when it is returned by our async call. The <code>|></code> (forward pipe) syntax is another thing that feels really strange, but it allows you to chain together functions quickly and with minimal fuss.</p>
<p>Next you'll find the real substance of our apps logic, the update function. <code>update</code> take in two parameters <code>msg</code> and <code>model</code>. Simply put, <code>model</code> tells us the current state of the app and <code>msg</code> tells us what action we should perform on that state. By pattern matching on <code>msg</code> we can call different functions based on the message we received. Note that the function should have the same return as our <code>init</code> function from earlier: the updated model, and a command to call (if any).</p>
<p>I think most of these are self explanatory (assuming you understand the <code>with</code> syntax, which creates a copy of the object with whatever changes are specificed): Increment returns the current model with count increased by the current Step amount, decement does the opposite, etc. But the last two cases are where you can see everything come together.</p>
<p>In the case where <code>msg</code> is <code>TimerToggled</code>, we return the model with an update to the <code>TimerOn</code> field with the value that we were supplied. As for the command, we return <code>timerCmd</code> if the value of <code>TimerOn</code> is <code>true</code> and no command if not.</p>
<p>The last case - where <code>msg</code> is <code>TimedTick</code> - is the message sent when <code>timerCmd</code> has completed. If the timer is on, we want to update the count by step and call <code>timerCmd</code> again. This puts us in a loop where the <code>timerCmd</code> is called, count is updated and then its called again. We can break this loop, by sending the <code>TimerToggled</code> message with a value of <code>false</code>.</p>
<p>So that's the update function. At its core, its a reducer that applies changes to the state based on the message that is sent. Again if you're familiar with ReactRedux, you've seen this before.</p>
<h2>Finally: The View</h2>
<div class="remark-highlight"><pre class="language-fsharp"><code class="language-fsharp"><span class="token keyword">let</span> view <span class="token punctuation">(</span>model<span class="token punctuation">:</span> <span class="token class-name">Model</span><span class="token punctuation">)</span> dispatch <span class="token operator">=</span>
        View<span class="token punctuation">.</span><span class="token function">ContentPage</span><span class="token punctuation">(</span>
          content <span class="token operator">=</span> View<span class="token punctuation">.</span><span class="token function">StackLayout</span><span class="token punctuation">(</span>padding <span class="token operator">=</span> Thickness <span class="token number">20.0</span><span class="token punctuation">,</span> verticalOptions <span class="token operator">=</span> LayoutOptions<span class="token punctuation">.</span>Center<span class="token punctuation">,</span>
            children <span class="token operator">=</span> <span class="token punctuation">[</span>
                View<span class="token punctuation">.</span><span class="token function">Label</span><span class="token punctuation">(</span>text <span class="token operator">=</span> sprintf <span class="token string">"%d"</span> model<span class="token punctuation">.</span>Count<span class="token punctuation">,</span> horizontalOptions <span class="token operator">=</span> LayoutOptions<span class="token punctuation">.</span>Center<span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">200.0</span><span class="token punctuation">,</span> horizontalTextAlignment<span class="token operator">=</span>TextAlignment<span class="token punctuation">.</span>Center<span class="token punctuation">)</span>
                View<span class="token punctuation">.</span><span class="token function">Button</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string">"Increment"</span><span class="token punctuation">,</span> command <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">fun</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> dispatch Increment<span class="token punctuation">)</span><span class="token punctuation">,</span> horizontalOptions <span class="token operator">=</span> LayoutOptions<span class="token punctuation">.</span>Center<span class="token punctuation">)</span>
                View<span class="token punctuation">.</span><span class="token function">Button</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string">"Decrement"</span><span class="token punctuation">,</span> command <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">fun</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> dispatch Decrement<span class="token punctuation">)</span><span class="token punctuation">,</span> horizontalOptions <span class="token operator">=</span> LayoutOptions<span class="token punctuation">.</span>Center<span class="token punctuation">)</span>
                View<span class="token punctuation">.</span><span class="token function">Label</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string">"Timer"</span><span class="token punctuation">,</span> horizontalOptions <span class="token operator">=</span> LayoutOptions<span class="token punctuation">.</span>Center<span class="token punctuation">)</span>
                View<span class="token punctuation">.</span><span class="token function">Switch</span><span class="token punctuation">(</span>isToggled <span class="token operator">=</span> model<span class="token punctuation">.</span>TimerOn<span class="token punctuation">,</span> toggled <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">fun</span> on <span class="token operator">-></span> dispatch <span class="token punctuation">(</span>TimerToggled on<span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> horizontalOptions <span class="token operator">=</span> LayoutOptions<span class="token punctuation">.</span>Center<span class="token punctuation">)</span>
                View<span class="token punctuation">.</span><span class="token function">Slider</span><span class="token punctuation">(</span>minimumMaximum <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value <span class="token operator">=</span> double model<span class="token punctuation">.</span>Step<span class="token punctuation">,</span> valueChanged <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">fun</span> args <span class="token operator">-></span> dispatch <span class="token punctuation">(</span>SetStep <span class="token punctuation">(</span>int <span class="token punctuation">(</span>args<span class="token punctuation">.</span>NewValue <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> horizontalOptions <span class="token operator">=</span> LayoutOptions<span class="token punctuation">.</span>FillAndExpand<span class="token punctuation">)</span>
                View<span class="token punctuation">.</span><span class="token function">Label</span><span class="token punctuation">(</span>text <span class="token operator">=</span> sprintf <span class="token string">"Step size: %d"</span> model<span class="token punctuation">.</span>Step<span class="token punctuation">,</span> horizontalOptions <span class="token operator">=</span> LayoutOptions<span class="token punctuation">.</span>Center<span class="token punctuation">)</span>
                View<span class="token punctuation">.</span><span class="token function">Button</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string">"Reset"</span><span class="token punctuation">,</span> horizontalOptions <span class="token operator">=</span> LayoutOptions<span class="token punctuation">.</span>Center<span class="token punctuation">,</span> command <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">fun</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> dispatch Reset<span class="token punctuation">)</span><span class="token punctuation">,</span> commandCanExecute <span class="token operator">=</span> <span class="token punctuation">(</span>model <span class="token operator">&#x3C;></span> initModel<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div>
<p>The view function returns the UI based on the current state. The view function should always be <strong>pure</strong>, meaning that it should contain no side effects and should always return the same output with the same input. In this example, we're using the standard Xamarin.Forms UI elements to render a Content Page with a Stack Layout. The children of the stack layout, are a Label for the count, a Button for increment and decrement, etc.</p>
<p>Notice that <code>view</code> takes two arguments, <code>model</code> and <code>dispatch</code>. As with everywhere else, <code>model</code> is the current state of our app. The second argument, <code>dispatch</code> is a special function that allows us to send messages to our update function.</p>
<p>There are a few places where <code>dispatch</code> is used. The "Increment" button dispatches an <code>Increment</code> message, on each click. The "Timer" switch, displays the current state of <code>model.TimerOn</code> and dispatches the <code>TimerToggled</code> message with the updated value when it is toggled. The slider calls <code>SetStep</code> based on the value of slider as it changes.</p>
<p>In each case, the UI element displays the current state of the Model (where necessary) and uses <code>dispatch</code> to send messages to <code>update</code>. This is the magic of MVU. Data flows in a very linear fashion, as the current state is passed to the view and the view dispatches an update. Rinse, repeat. (So I guess its more of a <em>circular</em> flow?)</p>
<h1>Final Thoughts</h1>
<p>There are plenty of things I don't like about F#. For one, I think that its easy for a language that encourages <em>less code</em> to encourage less readability. At the same time, I recognize that <em>more verbose</em> does not necessarily equal <em>more readable</em>, so... to each their own. What I really like about this approach is the same thing I have come to love about functional components in React (which is the only other "functional" environment that I regularly interact with). Because the view can only read the current state and dispatch updates to the state, its very easy to reason about what happens in any given scenario.</p>
<p>That's what excites me about MAUI. If the result is MVU's ability to make code more "reasonable" with the familiarity of C#, I really think I could be sold on it. The beauty of all this is that there are no plans to get rid of XAML or MVVM, so I'll always have that to fall back on, but I think there is really something to be said for the simplicity of MVU. That being said, this is just me scratching the surface. In order to do a full scale app (like Commutr V2), I'll have to figure out how to leverage composition to create smaller, more manageable components that can be combined together to accomplish complicated tasks.</p>
<p>But that's for a another day. 'Til next time!</p>
<p>(If I ever get around to it...)</p>
<hr>
<p>Turns out I did get around to it. Go check out <a href="/posts/mvu-composition.html">Exploring MVU Part 2: Composition</a>.</p>
</div></div></article></div></main></div><footer class="bg-accent-1 border-t border-accent-2"><div class="container mx-auto px-5"><div class="py-28 flex flex-col lg:flex-row items-center"><h3 class="text-4xl lg:text-5xl font-bold tracking-tighter leading-tight text-center lg:text-left mb-10 lg:mb-0 lg:pr-4 lg:w-1/2">The power is yours...</h3></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"date":"2020-05-21","slug":"2020-05-21-mvu-with-xamarin","content":"\u003cp\u003eThis week saw one of Microsoft's biggest conferences transition to a completely online format. We won't discuss the fact that this year's conference was \u003cstrong\u003esupposed\u003c/strong\u003e to be held just 30 minutes from my house and that I was hoping to attend, but I do want to talk a bit about some of this year's announcements in the .NET space that have taken over my brain. There's plenty to be excited about - \u003ca href=\"https://azure.microsoft.com/en-us/blog/azure-analytics-clarity-in-an-instant/\"\u003enew Azure services\u003c/a\u003e, \u003ca href=\"https://visualstudiomagazine.com/articles/2020/05/19/blazor-webassembly-3-2.aspx\"\u003eproduction-ready (?) Blazor\u003c/a\u003e, \u003ca href=\"https://devblogs.microsoft.com/dotnet/announcing-net-5-preview-4-and-our-journey-to-one-net/\"\u003e.NET Core 4 - err... I mean .NET 5\u003c/a\u003e - but what has really monopolized my thinking is how functional concepts keep making their way into C#.\u003c/p\u003e\n\u003cp\u003eI found this in two distinct efforts that were mentioned at this year's Build. The more obvious of the two is the \u003ca href=\"https://devblogs.microsoft.com/dotnet/welcome-to-c-9-0/\"\u003eaddition of Records and Init-only Properties in C# 9.0\u003c/a\u003e. This, along with some nice improvments to pattern matching, will mean that C# devs will be able to reap some more of the performance and readability benefits of a more Functional approach. The second place, was with the introduction of a technology that is still a year out from its first GA version: \u003ca href=\"https://devblogs.microsoft.com/dotnet/introducing-net-multi-platform-app-ui/\"\u003e.NET MAUI (Multi-platform App UI)\u003c/a\u003e. The idea here is to finally unify the split Xamarin/UWP experiences into a single developer experience. Now, this on its own is really cool (\u003cstrong\u003e\u003cem\u003eIOS, ANDROID, AND WINDOWS ALL IN THE SAME PROJECT?!?! GASP\u003c/em\u003e\u003c/strong\u003e), but they snuck something in here that again appears to point towards Functional paradigms coming enmasse to C#-land, namely, first class support for MVU (Model-View-Update).\u003c/p\u003e\n\u003cp\u003eNow C# devs are really familiar with M's and V's - we're all about MVC and MVVM - but I don't think very many of us are familiar with MVU. I've heard it discussed by people who have their toes in the Functional world, but never really dug in. In fact, I've always wanted to be one of those people that has their toes in the Functional world, but I've always given up long before I understood anything in a real sense. So I've convinced myself to give it another try, but this time in the hopes that I might get some insight into the future of mobile development on the .NET platform.\u003c/p\u003e\n\u003cp\u003eSo that's the plan (and the purpose of this article - only took me 3 paragraphs to get to it).\nI'm going to use F# and Xamarin.Forms to try out MVU in the hopes that I might gain some insight into what MAUI may bring.\u003c/p\u003e\n\u003cp\u003eThis may be a completely foolish attempt, but I think it has the highest possibility of getting me to actually try my hand at F#. Worst case, you'll never see this, because I'll never post it. Its a perfect system.\u003c/p\u003e\n\u003ch1\u003eFabulous F# and Xamarin.Forms\u003c/h1\u003e\n\u003cp\u003eAnyway, I started by doing some googling for MVU frameworks meant to work with Xamarin.Forms and within seconds I had run into \u003ca href=\"https://github.com/fsprojects/Fabulous/tree/master/Fabulous.XamarinForms\"\u003eFabulous for Xamarin.Forms\u003c/a\u003e. It looked like everything I needed, including a template project - which was a real plus. I won't bore you with the setup, just know that it was minimal (a couple of dotnet CLI commands) and that it resulted in this:\n\u003cimg src=\"/assets/posts/mvu-with-xamarin/solution-tree.png\" alt=\"Solution Tree\"\u003e\u003c/p\u003e\n\u003cp\u003eThats right folks, three F# projects, no XAML, and no C#.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003ch4\u003eSide Note: Project Name\u003c/h4\u003e\n\u003cp\u003eYou may be questioning why this project name is not \"MvuDemo\" or \"HelleWorldMvu\" or something. My plan is to ultimately recreate an app that I wrote a few years ago, which I use for mileage and fuel economy tracking. While its not important to this particular post, I figured I'd let you all in on this little personality tick of mine. When I start a project of any kind, I start with an end goal so large its impossible.\u003c/p\u003e\n\u003cp\u003eThere's a good chance \u003cem\u003ecommutrv2\u003c/em\u003e will never actually happen. When I first started this post, I assumed I would be able to get well beyond explaining the demo app. I quickly realized I needed to break down the demo app just so that I could understand it. So there you have it. When it comes to personal goals, I \u003cem\u003ealways\u003c/em\u003e over promise and under deliver.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eWas that a waste of your time? I hope not ... now where were we?\u003c/p\u003e\n\u003cp\u003eOh right, here's the contents of the single F# file generated in the shared project:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-fsharp\"\u003e\u003ccode class=\"language-fsharp\"\u003e\u003cspan class=\"token comment\"\u003e// Copyright 2018-2019 Fabulous contributors. See LICENSE.md for license.\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003enamespace\u003c/span\u003e commutr_v2\n\n\u003cspan class=\"token keyword\"\u003eopen\u003c/span\u003e System\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eDiagnostics\n\u003cspan class=\"token keyword\"\u003eopen\u003c/span\u003e Fabulous\n\u003cspan class=\"token keyword\"\u003eopen\u003c/span\u003e Fabulous\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eXamarinForms\n\u003cspan class=\"token keyword\"\u003eopen\u003c/span\u003e Fabulous\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eXamarinForms\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eLiveUpdate\n\u003cspan class=\"token keyword\"\u003eopen\u003c/span\u003e Xamarin\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eForms\n\n\u003cspan class=\"token keyword\"\u003emodule\u003c/span\u003e App \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eModel\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e Count \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eint\u003c/span\u003e\n        Step \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eint\u003c/span\u003e\n        TimerOn\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003ebool\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eMsg\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e Increment\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e Decrement\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e Reset\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e SetStep \u003cspan class=\"token keyword\"\u003eof\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eint\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e TimerToggled \u003cspan class=\"token keyword\"\u003eof\u003c/span\u003e \u003cspan class=\"token class-name\"\u003ebool\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e TimedTick\n\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e initModel \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e Count \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e Step \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e TimerOn\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token keyword\"\u003efalse\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e init \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e initModel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e Cmd\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003enone\n\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e timerCmd \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n        \u003cspan class=\"token computation-expression keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token keyword\"\u003edo\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003e Async\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eSleep \u003cspan class=\"token number\"\u003e200\u003c/span\u003e\n                \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e TimedTick \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003e\u003c/span\u003e Cmd\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eofAsyncMsg\n\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e update msg model \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ematch\u003c/span\u003e msg \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e Increment \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e model \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e Count \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCount \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eStep \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e Cmd\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003enone\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e Decrement \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e model \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e Count \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCount \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eStep \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e Cmd\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003enone\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e Reset \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e init \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e SetStep n \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e model \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e Step \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e n \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e Cmd\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003enone\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e TimerToggled on \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e model \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e TimerOn \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e on \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e on \u003cspan class=\"token keyword\"\u003ethen\u003c/span\u003e timerCmd \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e Cmd\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003enone\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e TimedTick \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eTimerOn \u003cspan class=\"token keyword\"\u003ethen\u003c/span\u003e\n                \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e model \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e Count \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCount \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eStep \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e timerCmd\n            \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\n                model\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e Cmd\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003enone\n\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e view \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eModel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e dispatch \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n        View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eContentPage\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n          content \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eStackLayout\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epadding \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Thickness \u003cspan class=\"token number\"\u003e20.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e verticalOptions \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e LayoutOptions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCenter\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            children \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n                View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eLabel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etext \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e sprintf \u003cspan class=\"token string\"\u003e\"%d\"\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCount\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e horizontalOptions \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e LayoutOptions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCenter\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e width\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e200.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e horizontalTextAlignment\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eTextAlignment\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCenter\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eButton\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etext \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Increment\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e command \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003efun\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e dispatch Increment\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e horizontalOptions \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e LayoutOptions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCenter\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eButton\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etext \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Decrement\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e command \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003efun\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e dispatch Decrement\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e horizontalOptions \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e LayoutOptions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCenter\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eLabel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etext \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Timer\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e horizontalOptions \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e LayoutOptions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCenter\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eSwitch\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eisToggled \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eTimerOn\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e toggled \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003efun\u003c/span\u003e on \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e dispatch \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eTimerToggled on\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eValue\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e horizontalOptions \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e LayoutOptions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCenter\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eSlider\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eminimumMaximum \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e0.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e10.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e value \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e double model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eStep\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e valueChanged \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003efun\u003c/span\u003e args \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e dispatch \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eSetStep \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eint \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eargs\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eNewValue \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.5\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e horizontalOptions \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e LayoutOptions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eFillAndExpand\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eLabel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etext \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e sprintf \u003cspan class=\"token string\"\u003e\"Step size: %d\"\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eStep\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e horizontalOptions \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e LayoutOptions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCenter\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eButton\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etext \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Reset\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e horizontalOptions \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e LayoutOptions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCenter\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e command \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003efun\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e dispatch Reset\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e commandCanExecute \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003e\u003c/span\u003e initModel\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e// Note, this declaration is needed if you enable LiveUpdate\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e program \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e XamarinFormsProgram\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emkProgram init update view\n\n\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eApp\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e app \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003einherit\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eApplication\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e runner \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n        App\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eprogram\n\u003cspan class=\"token preprocessor property\"\u003e#\u003cspan class=\"token directive keyword\"\u003eif\u003c/span\u003e DEBUG\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003e\u003c/span\u003e Program\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ewithConsoleTrace\n\u003cspan class=\"token preprocessor property\"\u003e#\u003cspan class=\"token directive keyword\"\u003eendif\u003c/span\u003e\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003e\u003c/span\u003e XamarinFormsProgram\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erun app\n\n\u003cspan class=\"token preprocessor property\"\u003e#\u003cspan class=\"token directive keyword\"\u003eif\u003c/span\u003e DEBUG\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// Uncomment this line to enable live update in debug mode.\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// See https://fsprojects.github.io/Fabulous/Fabulous.XamarinForms/tools.html#live-update for further  instructions.\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e//\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003edo\u003c/span\u003e runner\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eEnableLiveUpdate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token preprocessor property\"\u003e#\u003cspan class=\"token directive keyword\"\u003eendif\u003c/span\u003e\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e// Uncomment this code to save the application state to app.Properties using Newtonsoft.Json\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// See https://fsprojects.github.io/Fabulous/Fabulous.XamarinForms/models.html#saving-application-state for further  instructions.\u003c/span\u003e\n\u003cspan class=\"token preprocessor property\"\u003e#\u003cspan class=\"token directive keyword\"\u003eif\u003c/span\u003e APPSAVE\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e modelId \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"model\"\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eoverride\u003c/span\u003e __\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eOnSleep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n\n        \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e json \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Newtonsoft\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eJson\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eJsonConvert\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eSerializeObject\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003erunner\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCurrentModel\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        Console\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"OnSleep: saving model into app.Properties, json = {0}\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e json\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n        app\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eProperties\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003emodelId\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x3C;-\u003c/span\u003e json\n\n    \u003cspan class=\"token keyword\"\u003eoverride\u003c/span\u003e __\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eOnResume\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n        Console\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eWriteLine \u003cspan class=\"token string\"\u003e\"OnResume: checking for model in app.Properties\"\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003etry\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003ematch\u003c/span\u003e app\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eProperties\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eTryGetValue modelId \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e\n            \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:?\u003c/span\u003e string \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e json\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\n\n                Console\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"OnResume: restoring model from app.Properties, json = {0}\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e json\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e model \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Newtonsoft\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eJson\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eJsonConvert\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eDeserializeObject\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003eApp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eModel\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ejson\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n                Console\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eWriteLine\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"OnResume: restoring model from app.Properties, model = {0}\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003esprintf \u003cspan class=\"token string\"\u003e\"%0A\"\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                runner\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eSetCurrentModel \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e Cmd\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003enone\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n            \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e _ \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e ex \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\n            App\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eprogram\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eonError\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Error while restoring model found in app.Properties\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e ex\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003eoverride\u003c/span\u003e this\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eOnStart\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n        Console\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eWriteLine \u003cspan class=\"token string\"\u003e\"OnStart: using same logic as OnResume()\"\u003c/span\u003e\n        this\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eOnResume\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token preprocessor property\"\u003e#\u003cspan class=\"token directive keyword\"\u003eendif\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis is a pretty complicated example to start with, and it took me a little bit by surprise. But the gist of this example is that it is a counter, with a slider to adjust the \"step\" of the increment, and an optional timer feature which increments the count by the step amount every 200ms. Here's the UI to help you picture it.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/posts/mvu-with-xamarin/initial-example-screenshot.png\" alt=\"(Initial Example Screenshot)\"\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003ch4\u003eSide Note: Acknowledging My Own Limits\u003c/h4\u003e\n\u003cp\u003eJust as a note, we're going to skip everything from \u003ccode\u003elet program = XamarinFormsProgram.mkProgram init update view\u003c/code\u003e down as this is really just kind of \"wiring\" that sets up the framework. I included it here as it is part of the file and might be interesting for those who are a little more advanced in their knowledge of F# Xamarin development, but - to be truthfully honest - I don't understand most of it.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch1\u003eBreaking It Down\u003c/h1\u003e\n\u003cp\u003eNow I know there's a lot of code here and on top of that, there's quite a bit of syntax that looks quite strange if you're not familiar with F#, but there's really three key portions of this app that I think break down quite nicely. I know what you're thinking, \"Three you say? You mean the same as the number of letters in the acronym?\" And you're right, but you don't have to be so smug about it.\u003c/p\u003e\n\u003ch2\u003eFirst: The Model (and the Initialization Thereof)\u003c/h2\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-fsharp\"\u003e\u003ccode class=\"language-fsharp\"\u003e\u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eModel\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e Count \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eint\u003c/span\u003e\n        Step \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eint\u003c/span\u003e\n        TimerOn\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003ebool\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eMsg\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e Increment\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e Decrement\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e Reset\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e SetStep \u003cspan class=\"token keyword\"\u003eof\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eint\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e TimerToggled \u003cspan class=\"token keyword\"\u003eof\u003c/span\u003e \u003cspan class=\"token class-name\"\u003ebool\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e TimedTick\n\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e initModel \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e Count \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e Step \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e TimerOn\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token keyword\"\u003efalse\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e init \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e initModel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e Cmd\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003enone\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIn the above, we have two types. One is a record representing the data that will drive the app, and we've decided to call it \u003ccode\u003eModel\u003c/code\u003e (because its... the model). But the second one is actually what we call a Discriminated Union. The best description I've heard so far of Discriminated Unions is that they're \"enums on steroids\". They are similar to an enum where each value can be an \"object\" and they're really powerful. Anyway, all that syntax aside, this Discriminated Union is what we call the message. The importance of the message is that it tells us how the model should change. For those familiar with tools like ReactRedux, the message is similar to your action.\u003c/p\u003e\n\u003cp\u003eNext we have two \u003ccode\u003elet\u003c/code\u003e statements. The first describes the initial state. Notice that we do not specify that it is of the \u003ccode\u003eModel\u003c/code\u003e type, because types are inferred in F#. Its magic and its a lot less typing, and I'm not sure if I love it or hate it. The second let statement is essential, it is a function that returns the intial state (which we created in the previous statement) and a command. Commands are another key concept in MVU.\u003c/p\u003e\n\u003cp\u003eAs I understand it, the key reason for having commands is that they allow us to fire messages from within the update function (which we will discuss in more detail later). But there are several different kinds of commands which can be used to fire messages in different kinds of ways.The one you'll see used in this example is \u003ccode\u003eCmd.ofAsyncMsg\u003c/code\u003e. TThis command allow asynchrous messages to be piped in to our update function, which allows us to complete asynchronous tasks like waiting on a timer, making a database call, or issuing and resolving a REST request. I'm skipping ahead a bit here, but this should make more sense in a minute.\u003c/p\u003e\n\u003cp\u003eSo there we have it, the model, the message, and our initalizer.\u003c/p\u003e\n\u003ch2\u003eNext Up: Our Update Function\u003c/h2\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-fsharp\"\u003e\u003ccode class=\"language-fsharp\"\u003e\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e timerCmd \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n        \u003cspan class=\"token computation-expression keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token keyword\"\u003edo\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003e Async\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eSleep \u003cspan class=\"token number\"\u003e200\u003c/span\u003e\n                \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e TimedTick \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003e\u003c/span\u003e Cmd\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eofAsyncMsg\n\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e update msg model \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ematch\u003c/span\u003e msg \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e Increment \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e model \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e Count \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCount \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eStep \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e Cmd\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003enone\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e Decrement \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e model \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e Count \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCount \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eStep \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e Cmd\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003enone\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e Reset \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e init \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e SetStep n \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e model \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e Step \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e n \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e Cmd\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003enone\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e TimerToggled on \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e model \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e TimerOn \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e on \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e on \u003cspan class=\"token keyword\"\u003ethen\u003c/span\u003e timerCmd \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e Cmd\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003enone\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e TimedTick \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eTimerOn \u003cspan class=\"token keyword\"\u003ethen\u003c/span\u003e\n                \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e model \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e Count \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCount \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eStep \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e timerCmd\n            \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\n                model\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e Cmd\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003enone\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eSo in the above, we only have two statements. \u003ccode\u003etimerCmd\u003c/code\u003e is an asynchronous function which waits 200ms before returning a \u003ccode\u003eTimedTick\u003c/code\u003e, which you may recall was one of the cases in our Discriminated Union. This is then piped into an async message command, which will issue the \u003ccode\u003eTimedTick\u003c/code\u003e message when it is returned by our async call. The \u003ccode\u003e|\u003e\u003c/code\u003e (forward pipe) syntax is another thing that feels really strange, but it allows you to chain together functions quickly and with minimal fuss.\u003c/p\u003e\n\u003cp\u003eNext you'll find the real substance of our apps logic, the update function. \u003ccode\u003eupdate\u003c/code\u003e take in two parameters \u003ccode\u003emsg\u003c/code\u003e and \u003ccode\u003emodel\u003c/code\u003e. Simply put, \u003ccode\u003emodel\u003c/code\u003e tells us the current state of the app and \u003ccode\u003emsg\u003c/code\u003e tells us what action we should perform on that state. By pattern matching on \u003ccode\u003emsg\u003c/code\u003e we can call different functions based on the message we received. Note that the function should have the same return as our \u003ccode\u003einit\u003c/code\u003e function from earlier: the updated model, and a command to call (if any).\u003c/p\u003e\n\u003cp\u003eI think most of these are self explanatory (assuming you understand the \u003ccode\u003ewith\u003c/code\u003e syntax, which creates a copy of the object with whatever changes are specificed): Increment returns the current model with count increased by the current Step amount, decement does the opposite, etc. But the last two cases are where you can see everything come together.\u003c/p\u003e\n\u003cp\u003eIn the case where \u003ccode\u003emsg\u003c/code\u003e is \u003ccode\u003eTimerToggled\u003c/code\u003e, we return the model with an update to the \u003ccode\u003eTimerOn\u003c/code\u003e field with the value that we were supplied. As for the command, we return \u003ccode\u003etimerCmd\u003c/code\u003e if the value of \u003ccode\u003eTimerOn\u003c/code\u003e is \u003ccode\u003etrue\u003c/code\u003e and no command if not.\u003c/p\u003e\n\u003cp\u003eThe last case - where \u003ccode\u003emsg\u003c/code\u003e is \u003ccode\u003eTimedTick\u003c/code\u003e - is the message sent when \u003ccode\u003etimerCmd\u003c/code\u003e has completed. If the timer is on, we want to update the count by step and call \u003ccode\u003etimerCmd\u003c/code\u003e again. This puts us in a loop where the \u003ccode\u003etimerCmd\u003c/code\u003e is called, count is updated and then its called again. We can break this loop, by sending the \u003ccode\u003eTimerToggled\u003c/code\u003e message with a value of \u003ccode\u003efalse\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eSo that's the update function. At its core, its a reducer that applies changes to the state based on the message that is sent. Again if you're familiar with ReactRedux, you've seen this before.\u003c/p\u003e\n\u003ch2\u003eFinally: The View\u003c/h2\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-fsharp\"\u003e\u003ccode class=\"language-fsharp\"\u003e\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e view \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eModel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e dispatch \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n        View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eContentPage\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n          content \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eStackLayout\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epadding \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Thickness \u003cspan class=\"token number\"\u003e20.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e verticalOptions \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e LayoutOptions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCenter\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n            children \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n                View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eLabel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etext \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e sprintf \u003cspan class=\"token string\"\u003e\"%d\"\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCount\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e horizontalOptions \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e LayoutOptions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCenter\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e width\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e200.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e horizontalTextAlignment\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eTextAlignment\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCenter\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eButton\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etext \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Increment\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e command \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003efun\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e dispatch Increment\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e horizontalOptions \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e LayoutOptions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCenter\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eButton\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etext \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Decrement\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e command \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003efun\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e dispatch Decrement\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e horizontalOptions \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e LayoutOptions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCenter\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eLabel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etext \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Timer\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e horizontalOptions \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e LayoutOptions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCenter\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eSwitch\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eisToggled \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eTimerOn\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e toggled \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003efun\u003c/span\u003e on \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e dispatch \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eTimerToggled on\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eValue\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e horizontalOptions \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e LayoutOptions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCenter\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eSlider\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eminimumMaximum \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e0.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e10.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e value \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e double model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eStep\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e valueChanged \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003efun\u003c/span\u003e args \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e dispatch \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eSetStep \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eint \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eargs\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eNewValue \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.5\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e horizontalOptions \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e LayoutOptions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eFillAndExpand\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eLabel\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etext \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e sprintf \u003cspan class=\"token string\"\u003e\"Step size: %d\"\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eStep\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e horizontalOptions \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e LayoutOptions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCenter\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                View\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eButton\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003etext \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Reset\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e horizontalOptions \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e LayoutOptions\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eCenter\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e command \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003efun\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003e\u003c/span\u003e dispatch Reset\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e commandCanExecute \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003e\u003c/span\u003e initModel\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe view function returns the UI based on the current state. The view function should always be \u003cstrong\u003epure\u003c/strong\u003e, meaning that it should contain no side effects and should always return the same output with the same input. In this example, we're using the standard Xamarin.Forms UI elements to render a Content Page with a Stack Layout. The children of the stack layout, are a Label for the count, a Button for increment and decrement, etc.\u003c/p\u003e\n\u003cp\u003eNotice that \u003ccode\u003eview\u003c/code\u003e takes two arguments, \u003ccode\u003emodel\u003c/code\u003e and \u003ccode\u003edispatch\u003c/code\u003e. As with everywhere else, \u003ccode\u003emodel\u003c/code\u003e is the current state of our app. The second argument, \u003ccode\u003edispatch\u003c/code\u003e is a special function that allows us to send messages to our update function.\u003c/p\u003e\n\u003cp\u003eThere are a few places where \u003ccode\u003edispatch\u003c/code\u003e is used. The \"Increment\" button dispatches an \u003ccode\u003eIncrement\u003c/code\u003e message, on each click. The \"Timer\" switch, displays the current state of \u003ccode\u003emodel.TimerOn\u003c/code\u003e and dispatches the \u003ccode\u003eTimerToggled\u003c/code\u003e message with the updated value when it is toggled. The slider calls \u003ccode\u003eSetStep\u003c/code\u003e based on the value of slider as it changes.\u003c/p\u003e\n\u003cp\u003eIn each case, the UI element displays the current state of the Model (where necessary) and uses \u003ccode\u003edispatch\u003c/code\u003e to send messages to \u003ccode\u003eupdate\u003c/code\u003e. This is the magic of MVU. Data flows in a very linear fashion, as the current state is passed to the view and the view dispatches an update. Rinse, repeat. (So I guess its more of a \u003cem\u003ecircular\u003c/em\u003e flow?)\u003c/p\u003e\n\u003ch1\u003eFinal Thoughts\u003c/h1\u003e\n\u003cp\u003eThere are plenty of things I don't like about F#. For one, I think that its easy for a language that encourages \u003cem\u003eless code\u003c/em\u003e to encourage less readability. At the same time, I recognize that \u003cem\u003emore verbose\u003c/em\u003e does not necessarily equal \u003cem\u003emore readable\u003c/em\u003e, so... to each their own. What I really like about this approach is the same thing I have come to love about functional components in React (which is the only other \"functional\" environment that I regularly interact with). Because the view can only read the current state and dispatch updates to the state, its very easy to reason about what happens in any given scenario.\u003c/p\u003e\n\u003cp\u003eThat's what excites me about MAUI. If the result is MVU's ability to make code more \"reasonable\" with the familiarity of C#, I really think I could be sold on it. The beauty of all this is that there are no plans to get rid of XAML or MVVM, so I'll always have that to fall back on, but I think there is really something to be said for the simplicity of MVU. That being said, this is just me scratching the surface. In order to do a full scale app (like Commutr V2), I'll have to figure out how to leverage composition to create smaller, more manageable components that can be combined together to accomplish complicated tasks.\u003c/p\u003e\n\u003cp\u003eBut that's for a another day. 'Til next time!\u003c/p\u003e\n\u003cp\u003e(If I ever get around to it...)\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003eTurns out I did get around to it. Go check out \u003ca href=\"/posts/mvu-composition.html\"\u003eExploring MVU Part 2: Composition\u003c/a\u003e.\u003c/p\u003e\n","author":"Austin Webre","title":"Exploring MVU and Functional Paradigms in Xamarin.Forms","categories":["Posts"]}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"2020-05-21-mvu-with-xamarin"},"buildId":"462EShwFYaOEnlIebvUk7","assetPrefix":"/nextjs-blog","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>